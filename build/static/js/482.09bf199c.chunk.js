(self.webpackChunkmypima_front=self.webpackChunkmypima_front||[]).push([[482],{78482:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return j}});var i=t(4942),r=t(1413),s=t(29439),a=t(72791),o=t(32543),c=t(84376),d=t(86586),l=t(16704),u=t(65218),m=t(64802),p=t(80184),f=[{name:"Compost"},{name:"Record Book"},{name:"Shade Management"},{name:"Weeding"},{name:"Stumping"},{name:"Main Stems"}],g=function(){return(0,p.jsxs)("div",{className:"loading-container",children:[(0,p.jsx)("div",{className:"spinner"}),(0,p.jsx)("p",{children:"Loading, please wait..."})]})},v=function(e){var n=e.message;return(0,p.jsx)("div",{className:"error-container",children:(0,p.jsxs)("div",{className:"error-message",children:[(0,p.jsx)("h3",{children:"Something went wrong"}),(0,p.jsx)("p",{children:n}),(0,p.jsx)("button",{onClick:function(){return window.location.reload()},children:"Try Again"})]})})},h=function(e){var n,t,i=e.practice,r=e.onSelect,s=e.projectId,a=(0,o.a)(l.a5,{variables:{projectId:s,practiceName:i.name}}),c=a.data,d=a.loading,u=a.error;return(0,p.jsxs)("div",{className:"practice-card",onClick:function(){return r(i)},children:[(0,p.jsx)("h3",{children:i.name}),d&&(0,p.jsx)(g,{}),u&&(0,p.jsx)(v,{message:u.message}),!d&&!u&&(0,p.jsxs)("div",{className:"progress",children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Reviewed:"})," ",(null===c||void 0===c||null===(n=c.getBestPracticeReviewStats)||void 0===n?void 0:n.reviewedVisits)||0]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Remaining:"})," ",(null===c||void 0===c||null===(t=c.getBestPracticeReviewStats)||void 0===t?void 0:t.remainingVisits)||0]})]})]})},j=function(e){var n=e.selectedProject,t=e.userId,j=(0,a.useState)(null),_=(0,s.Z)(j,2),x=_[0],b=_[1],w=(0,a.useState)(0),S=(0,s.Z)(w,2),y=S[0],I=S[1],$=(0,a.useState)([]),P=(0,s.Z)($,2),N=P[0],V=P[1],A=(0,a.useState)([]),B=(0,s.Z)(A,2),F=B[0],Z=B[1],R=(0,a.useState)({}),k=(0,s.Z)(R,2),E=k[0],C=k[1],q=(0,a.useState)({}),U=(0,s.Z)(q,2),L=U[0],M=U[1],T=(0,a.useState)(null),Q=(0,s.Z)(T,2),G=Q[0],O=Q[1],D=(0,a.useState)({}),H=(0,s.Z)(D,2),z=H[0],X=H[1],W=(0,a.useState)(!1),Y=(0,s.Z)(W,2),K=Y[0],J=Y[1],ee=(0,a.useState)(!1),ne=(0,s.Z)(ee,2),te=ne[0],ie=ne[1],re=(0,o.a)(l.Uj,{variables:{projectId:n}}),se=re.data,ae=re.loading,oe=re.error,ce=(0,o.a)(l.sr,{variables:{projectId:n,practiceName:x?x.name:"",page:0,pageSize:1e3},skip:!x,fetchPolicy:"network-only"}),de=ce.data,le=ce.loading,ue=ce.error,me=ce.refetch,pe=(0,c.D)(l.jb),fe=(0,s.Z)(pe,1)[0],ge=(0,d.t)(l._X,{fetchPolicy:"network-only"}),ve=(0,s.Z)(ge,1)[0];(0,a.useEffect)((function(){de&&de.getPaginatedReviews&&V(de.getPaginatedReviews)}),[de]),(0,a.useEffect)((function(){if(x){var e=N.filter((function(e){return e.BestPractices.some((function(e){return e.practice_name===x.name}))}));Z(e)}}),[x,N]);var he=function(e){b(e),I(0),C({}),M({}),me({practiceName:e.name})},je=function(e,n){for(var t=atob(e),i=[],r=0;r<t.length;r+=512){for(var s=t.slice(r,r+512),a=new Array(s.length),o=0;o<s.length;o++)a[o]=s.charCodeAt(o);var c=new Uint8Array(a);i.push(c)}return new Blob(i,{type:n})};if(ae)return(0,p.jsx)(g,{});if(oe)return(0,p.jsx)(v,{message:oe.message});var _e=se.getSampledVisitsStats,xe=_e.totalSampledVisits,be=_e.totalReviewed,we=_e.remainingVisits;return(0,p.jsx)("div",{className:"farm-visit-app",children:x?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"indicator",children:(0,p.jsx)("span",{onClick:function(){b(null),I(0),C({}),M({})},className:"indicator-link",children:"Back to Practice Overview"})}),(0,p.jsxs)("h2",{className:"sub-header",children:["Reviewing ",x.name]}),le&&(0,p.jsx)(g,{}),ue&&(0,p.jsx)(v,{message:ue.message}),!le&&!ue&&F.length>0&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"visit-list",children:F.slice(5*y,5*(y+1)).map((function(e){var n,t=e.BestPractices.find((function(e){return e.practice_name===x.name})),a=(null===t||void 0===t||null===(n=t.image_url)||void 0===n?void 0:n.split("/").slice(-2))||[],o=(0,s.Z)(a,2),c=o[0],d=o[1];return(0,p.jsxs)("div",{className:"visit-item",children:[(0,p.jsxs)("div",{className:"visit-details",children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Farmer PIMA ID:"})," ",e.farmer_pima_id]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Farmer TNS ID:"})," ",e.farmer_tns_id]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Date Visited:"})," ",e.date_visited]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Farmer Name:"})," ",e.farmer_name]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Farmer Trainer:"})," ",e.farmer_trainer]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Question:"})," ",(null===t||void 0===t?void 0:t.question)||"N/A"]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Observation:"})," ",(null===t||void 0===t?void 0:t.answer)||"N/A"]})]}),(0,p.jsxs)("div",{className:"visit-image",children:[z[d]&&(0,p.jsx)(g,{}),(0,p.jsx)("img",{src:null!==t&&void 0!==t&&t.image_url?"".concat("https://api.pima.ink","/image/").concat(c,"/").concat(d):"https://via.placeholder.com/150",alt:"Farm Visit",style:{display:z[d]?"none":"block"},onLoad:function(){return function(e){X((function(n){return(0,r.Z)((0,r.Z)({},n),{},(0,i.Z)({},e,!1))}))}(d)},onError:function(){return function(e){X((function(n){return(0,r.Z)((0,r.Z)({},n),{},(0,i.Z)({},e,!1))}))}(d)},onClick:function(){return function(e,n){O("".concat("https://api.pima.ink","/image/").concat(e,"/").concat(n))}(c,d)}})]}),(0,p.jsxs)("div",{className:"answer-field",children:[(0,p.jsx)("label",{children:"Correct Answer?"}),(0,p.jsxs)("select",{value:E[e.visit_id]||"",onChange:function(n){return t=e.visit_id,s=n.target.value,void C((function(e){return(0,r.Z)((0,r.Z)({},e),{},(0,i.Z)({},t,s))}));var t,s},children:[(0,p.jsx)("option",{value:"",children:"-- Select --"}),(0,p.jsx)("option",{value:"Yes",children:"Yes"}),(0,p.jsx)("option",{value:"No",children:"No"}),(0,p.jsx)("option",{value:"Unclear",children:"Unclear"})]})]}),(0,p.jsxs)("div",{className:"comment-field",children:[(0,p.jsx)("label",{children:"Comments:"}),(0,p.jsx)("textarea",{value:L[e.visit_id]||"",onChange:function(n){return t=e.visit_id,s=n.target.value,void M((function(e){return(0,r.Z)((0,r.Z)({},e),{},(0,i.Z)({},t,s))}));var t,s},placeholder:"Optional comments..."})]})]},e.visit_id)}))}),(0,p.jsxs)("div",{className:"pagination-controls",children:[(0,p.jsx)("button",{disabled:0===y,onClick:function(){return I(y-1)},children:"Previous Page"}),(0,p.jsx)("button",{disabled:y>=Math.floor(F.length/5),onClick:function(){return I(y+1)},children:"Next Page"})]}),(0,p.jsx)("button",{className:"submit-button",onClick:function(){var e=F.slice(5*y,5*(y+1));if(e.every((function(e){return E[e.visit_id]}))){var n=e.map((function(e){return{practice_id:e.BestPractices.find((function(e){return e.practice_name===x.name})).practice_id,correct_answer:E[e.visit_id].toLowerCase(),comment:L[e.visit_id]||"",user_id:t}}));J(!0),fe({variables:{input:n}}).then((function(e){J(!1),e.data.submitBatch.success?(u.Am.success("Batch submitted successfully!"),C({}),M({}),I(0),me({fetchPolicy:"network-only"})):u.Am.error("Failed to submit batch: "+e.data.submitBatch.message)})).catch((function(e){J(!1),console.error("Error submitting batch:",e),u.Am.error("An error occurred while submitting the batch.")}))}else u.Am.error("Please fill out 'Correct Answer?' for all records before submitting.")},disabled:K,children:K?"Submitting...":"Submit Batch"})]}),G&&(0,p.jsx)("div",{className:"image-modal",onClick:function(){O(null)},children:(0,p.jsx)("img",{src:G,alt:"Fullscreen Farm Visit"})})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"dashboard-header",children:[(0,p.jsxs)("div",{className:"dashboard-info",children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Total Sampled Visits:"})," ",xe]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Total Reviewed:"})," ",be]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"Remaining Visits:"})," ",we]})]}),(0,p.jsx)("button",{className:"download-button",onClick:function(){n?(ie(!0),ve({variables:{projectId:n}}).then((function(e){var n=e.data.generateFarmVisitReport;if(200===n.status&&n.file){var t=n.file.split(",")[1],i=je(t,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");(0,m.saveAs)(i,"farm_visit_statistics.xlsx"),u.Am.success("Download started.")}else u.Am.error(n.message||"Failed to generate report.");ie(!1)})).catch((function(e){console.error("Error generating report:",e),u.Am.error("An error occurred while generating the report."),ie(!1)}))):u.Am.error("No project selected.")},disabled:te,children:te?"Downloading...":"Download Report"})]}),(0,p.jsx)("h1",{className:"dashboard-title",children:"Choose Adoption Method to Review"}),(0,p.jsx)("div",{className:"practices-container",children:f.map((function(e){return(0,p.jsx)(h,{practice:e,projectId:n,onSelect:he},e.name)}))})]})})}},16704:function(e,n,t){"use strict";t.d(n,{QR:function(){return b},Uj:function(){return I},Uv:function(){return w},_X:function(){return N},a5:function(){return $},iF:function(){return y},jb:function(){return V},nM:function(){return S},sr:function(){return P}});var i,r,s,a,o,c,d,l,u,m,p,f,g,v,h,j,_=t(30168),x=t(9383),b=(0,x.Ps)(i||(i=(0,_.Z)(["\n  query GetFarmVisitsByProject($projectId: String!) {\n    getFarmVisitsByProject(project_id: $projectId) {\n      message\n      status\n      farmVisits {\n        fv_id\n        training_group\n        farmer_tns_id\n        household_tns_id\n        farm_visited\n        farmer_trainer\n        date_visited\n        pima_household_id\n        pima_farmer_id\n      }\n    }\n  }\n"]))),w=(0,x.Ps)(r||(r=(0,_.Z)(["\n  query GetFarmVisitsByGroup($tgId: String!) {\n    getFarmVisitsByGroup(tg_id: $tgId) {\n      message\n      status\n      farmVisits {\n        fv_id\n        fv_name\n        training_group\n        training_session\n        tns_id\n        farm_visited\n        household_id\n        farmer_trainer\n        has_training\n        date_visited\n      }\n    }\n  }\n"]))),S=((0,x.Ps)(s||(s=(0,_.Z)(["\n  query GetFarmVisitsBySession($tsId: String!) {\n    getFarmVisitsBySession(ts_id: $tsId) {\n      message\n      status\n      farmVisits {\n        fv_id\n        fv_name\n        training_group\n        training_session\n        tns_id\n        farm_visited\n        household_id\n        farmer_trainer\n        has_training\n        date_visited\n      }\n    }\n  }\n"]))),(0,x.Ps)(a||(a=(0,_.Z)(["\n  query GetFarmVisitsByParticipant($partId: String!) {\n    getFarmVisitsByParticipant(part_id: $partId) {\n      message\n      status\n      farmVisits {\n        fv_id\n        fv_name\n        training_group\n        training_session\n        tns_id\n        farm_visited\n        household_id\n        farmer_trainer\n        has_training\n        date_visited\n      }\n    }\n  }\n"]))),(0,x.Ps)(o||(o=(0,_.Z)(["\n  query GetFVQAsByFarmVisits($fvId: String!) {\n    getFVQAsByFarmVisits(fv_id: $fvId) {\n      message\n      status\n      fvQAs {\n        bp_id\n        fv_id\n        qas {\n          practice_name_id\n          practice_name\n          questions\n          answers\n        }\n      }\n    }\n  }\n"])))),y=(0,x.Ps)(c||(c=(0,_.Z)(["\n  mutation UpdateFVQAImageStatus(\n    $bpId: String!\n    $fieldName: FieldNames!\n    $imageStatus: Status!\n  ) {\n    updateFVQAImageStatus(\n      bp_id: $bpId\n      field_name: $fieldName\n      image_status: $imageStatus\n    ) {\n      message\n      status\n    }\n  }\n"]))),I=((0,x.Ps)(d||(d=(0,_.Z)(["\n  query getFVQAsByProjectForReview(\n    $projectId: String!\n    $limit: Int!\n    $offset: Int!\n  ) {\n    getFVQAsByProjectForReview(\n      project_id: $projectId\n      limit: $limit\n      offset: $offset\n    ) {\n      message\n      status\n      farmVisits {\n        fv_id\n        training_group\n        training_session\n        tns_id\n        farm_visited\n        household_id\n        farmer_trainer\n        has_training\n        date_visited\n        status\n        qas {\n          practice_name_id\n          practice_name\n          questions\n          answers\n        }\n      }\n    }\n  }\n"]))),(0,x.Ps)(l||(l=(0,_.Z)(["\n  query getFVQAsByProjectInExcel($projectId: String!, $practiceName: String!) {\n    getFVQAsByProjectInExcel(\n      project_id: $projectId\n      practice_name: $practiceName\n    ) {\n      message\n      status\n      file\n    }\n  }\n"]))),(0,x.Ps)(u||(u=(0,_.Z)(["\n  query getFVQAsByProjectInExcel($projectId: String!, $practiceName: String!) {\n    getFVQAsByProjectInExcel(\n      project_id: $projectId\n      practice_name: $practiceName\n    ) {\n      message\n      status\n      file\n    }\n  }\n"]))),(0,x.Ps)(m||(m=(0,_.Z)(["\n  mutation UploadParticipants($partsFile: Upload!) {\n    uploadParticipants(parts_file: $partsFile) {\n      message\n      status\n    }\n  }\n"]))),(0,x.Ps)(p||(p=(0,_.Z)(["\n  query GetSampledVisitsStats($projectId: String!) {\n    getSampledVisitsStats(projectId: $projectId) {\n      totalSampledVisits\n      totalReviewed\n      remainingVisits\n    }\n  }\n"])))),$=(0,x.Ps)(f||(f=(0,_.Z)(["\n  query GetBestPracticeStats($projectId: String!, $practiceName: String!) {\n    getBestPracticeReviewStats(\n      projectId: $projectId\n      practiceName: $practiceName\n    ) {\n      reviewedVisits\n      remainingVisits\n      totalVisits\n    }\n  }\n"]))),P=(0,x.Ps)(g||(g=(0,_.Z)(["\n  query GetPaginatedReviews(\n    $projectId: String!\n    $practiceName: String!\n    $page: Int!\n    $pageSize: Int!\n  ) {\n    getPaginatedReviews(\n      projectId: $projectId\n      practiceName: $practiceName\n      page: $page\n      pageSize: $pageSize\n    ) {\n      visit_id\n      sf_visit_id\n      farmer_name\n      farmer_pima_id\n      farmer_tns_id\n      date_visited\n      farmer_trainer\n      BestPractices {\n        practice_id\n        practice_name\n        image_url\n        sf_practice_id\n        question\n        answer\n      }\n    }\n  }\n"]))),N=(0,x.Ps)(v||(v=(0,_.Z)(["\n  query GenerateFarmVisitReport($projectId: String!) {\n    generateFarmVisitReport(projectId: $projectId) {\n      message\n      status\n      file\n    }\n  }\n"]))),V=((0,x.Ps)(h||(h=(0,_.Z)(["\n  mutation SubmitBatch($input: [BatchInput!]!) {\n    submitBatch(input: $input) {\n      success\n      message\n    }\n  }\n"]))),(0,x.Ps)(j||(j=(0,_.Z)(["\n  mutation SubmitBatch($input: [BatchInput!]!) {\n    submitBatch(input: $input) {\n      success\n      message\n    }\n  }\n"]))))},64802:function(e,n,t){var i,r,s;r=[],void 0===(s="function"===typeof(i=function(){"use strict";function n(e,n){return"undefined"==typeof n?n={autoBom:!1}:"object"!=typeof n&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function i(e,n,t){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){c(i.response,n,t)},i.onerror=function(){console.error("could not download file")},i.send()}function r(e){var n=new XMLHttpRequest;n.open("HEAD",e,!1);try{n.send()}catch(e){}return 200<=n.status&&299>=n.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(i){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof t.g&&t.g.global===t.g?t.g:void 0,o=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,n,t){var o=a.URL||a.webkitURL,c=document.createElement("a");n=n||e.name||"download",c.download=n,c.rel="noopener","string"==typeof e?(c.href=e,c.origin===location.origin?s(c):r(c.href)?i(e,n,t):s(c,c.target="_blank")):(c.href=o.createObjectURL(e),setTimeout((function(){o.revokeObjectURL(c.href)}),4e4),setTimeout((function(){s(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,t,a){if(t=t||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(n(e,a),t);else if(r(e))i(e,t,a);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout((function(){s(o)}))}}:function(e,n,t,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return i(e,n,t);var s="application/octet-stream"===e.type,c=/constructor/i.test(a.HTMLElement)||a.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||s&&c||o)&&"undefined"!=typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=d?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},l.readAsDataURL(e)}else{var u=a.URL||a.webkitURL,m=u.createObjectURL(e);r?r.location=m:location.href=m,r=null,setTimeout((function(){u.revokeObjectURL(m)}),4e4)}});a.saveAs=c.saveAs=c,e.exports=c})?i.apply(n,r):i)||(e.exports=s)}}]);
//# sourceMappingURL=482.09bf199c.chunk.js.map