"use strict";(self.webpackChunkmypima_front=self.webpackChunkmypima_front||[]).push([[608],{50284:function(e,n,s){s(72791);var r=s(13239),t=s(80184);n.Z=function(){return(0,t.jsxs)("div",{className:"circular_progress",children:[(0,t.jsxs)("div",{className:"spinner-container",children:[(0,t.jsx)("div",{className:"spinner-glow"}),(0,t.jsx)(r.Z,{className:"spinner",size:80,thickness:4.5,style:{color:"#1b2a4e"}})]}),(0,t.jsx)("h2",{children:"Loading Data..."})]})}},59898:function(e,n,s){s.d(n,{Z:function(){return t}});s(72791);var r=s(80184),t=function(e){var n=e.heading,s=e.figures,t=e.icon,i=e.color;return(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"card__container",children:(0,r.jsxs)("div",{className:"card__content",children:[(0,r.jsxs)("div",{className:"card__text",children:[(0,r.jsx)("p",{className:"card__text1",children:n}),(0,r.jsx)("p",{className:"card__text2",children:s})]}),(0,r.jsxs)("div",{className:"card__icon",style:{backgroundColor:i},children:[t," "]})]})})})}},85608:function(e,n,s){s.r(n),s.d(n,{default:function(){return T}});var r=s(4942),t=s(1413),i=s(29439),a=s(72791),l=s(32543),c=s(86586),o=s(84376),d=s(69961),u=s(17626),h=s(6042),m=s(59500),p=s(78559),x=s(64802),v=s(96019),j=s(65218),f=s(59898),g=s(16856),Z=s(39126),b=s(80184),w=function(e){var n=e.sampledSessions,s=[{heading:"Total Sampled",figures:n.length,icon:(0,b.jsx)(g.te,{}),color:"#25245D"},{heading:"Total Reviewed",figures:n.filter((function(e){return null!==e.image_review_result})).length,icon:(0,b.jsx)(g.te,{}),color:"#087C8F"},{heading:"Not Reviewed",figures:n.filter((function(e){return null===e.image_review_result})).length,icon:(0,b.jsx)(Z.gW$,{}),color:"#25245D"}];return(0,b.jsxs)("div",{style:{width:"100%",marginBottom:"20px",display:"flex"},children:[s.map((function(e,n){return(0,b.jsx)("div",{children:(0,b.jsx)(f.Z,{heading:e.heading,figures:e.figures,icon:e.icon,color:e.color})},n)}))," "]})},N=s(4567),_=s(27391),y=s(23786),S=s(78914),A=s(71652),C=s(64356),k=s(99252),M=s(28030),D=s(16386),I=s(50284),T=function(e){var n=e.selectedProject,s=e.userId,f=(0,l.a)(v.MQ,{variables:{projectId:n},fetchPolicy:"network-only"}),g=f.data,Z=f.loading,T=f.error,z=f.refetch,E=(0,c.t)(v.jA,{fetchPolicy:"network-only"}),F=(0,i.Z)(E,1)[0],R=(0,a.useState)([]),J=(0,i.Z)(R,2),B=J[0],P=J[1],U=(0,a.useState)([]),V=(0,i.Z)(U,2),O=V[0],W=V[1],G=(0,o.D)(v.jb),L=(0,i.Z)(G,1)[0],H=(0,a.useState)({}),Q=(0,i.Z)(H,2),Y=Q[0],$=Q[1],q=(0,a.useState)(!1),K=(0,i.Z)(q,2),X=K[0],ee=K[1],ne=(0,a.useState)(null),se=(0,i.Z)(ne,2),re=se[0],te=se[1],ie=(0,a.useState)({}),ae=(0,i.Z)(ie,2),le=ae[0],ce=ae[1],oe=(0,a.useState)(!1),de=(0,i.Z)(oe,2),ue=de[0],he=de[1],me=(0,a.useState)(null),pe=(0,i.Z)(me,2),xe=pe[0],ve=pe[1],je=(0,a.useRef)(null),fe=(0,a.useState)(!1),ge=(0,i.Z)(fe,2),Ze=ge[0],be=ge[1],we=(0,a.useState)((0,M.Z)(new Date,1)),Ne=(0,i.Z)(we,2),_e=Ne[0],ye=Ne[1],Se=(0,a.useState)(new Date),Ae=(0,i.Z)(Se,2),Ce=Ae[0],ke=Ae[1],Me=(0,a.useState)("approved"),De=(0,i.Z)(Me,2),Ie=De[0],Te=De[1];(0,a.useEffect)((function(){X&&je.current&&setTimeout((function(){je.current.invalidateSize()}),300)}),[X]),(0,a.useEffect)((function(){if(g){P(g.sampledTrainingSessions);var e=g.sampledTrainingSessions.reduce((function(e,n){return e[n.id]=!0,e}),{});ce(e);var n=g.sampledTrainingSessions.filter((function(e){return null===e.image_review_result}));W(n)}}),[g]);var ze=function(){return O.slice(0,5).every((function(e){return Y[e.id]}))},Ee=function(e,n){for(var s=atob(e),r=[],t=0;t<s.length;t+=512){for(var i=s.slice(t,t+512),a=new Array(i.length),l=0;l<i.length;l++)a[l]=i.charCodeAt(l);var c=new Uint8Array(a);r.push(c)}return new Blob(r,{type:n})},Fe=re?{lat:re.ts_latitude,lng:re.ts_longitude}:{lat:-1.2921,lng:36.8219},Re=(0,p.icon)({iconUrl:"https://img.icons8.com/?size=100&id=60013&format=png&color=000000",iconSize:[35,35],iconAnchor:[22,94],popupAnchor:[-3,-76]});if(Z)return(0,b.jsx)(I.Z,{});if(T)return(0,b.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,b.jsx)(N.Z,{color:"error",children:"Error loading data"})});var Je=0===O.length;return(0,b.jsxs)("div",{className:"training-session-app",children:[(0,b.jsxs)("div",{className:"dashboard",children:[(0,b.jsx)("h1",{className:"dashboard-title",children:"Training Session Overview"}),(0,b.jsx)(w,{sampledSessions:B})]}),(0,b.jsxs)("div",{className:"report-controls",children:[(0,b.jsx)(A._,{dateAdapter:k.H,children:(0,b.jsxs)("div",{className:"date-controls",children:[(0,b.jsx)(C.M,{label:"Start Date",value:_e,onChange:function(e){return ye(e)},renderInput:function(e){return(0,b.jsx)(_.Z,(0,t.Z)({},e))}}),(0,b.jsx)(C.M,{label:"End Date",value:Ce,onChange:function(e){return ke(e)},renderInput:function(e){return(0,b.jsx)(_.Z,(0,t.Z)({},e))}})]})}),(0,b.jsxs)(_.Z,{className:"status-select",label:"Status",select:!0,value:Ie,onChange:function(e){return Te(e.target.value)},variant:"outlined",children:[(0,b.jsx)(y.Z,{value:"all",children:"All"}),(0,b.jsx)(y.Z,{value:"approved",children:"Correct"}),(0,b.jsx)(y.Z,{value:"invalid",children:"Incorrect"}),(0,b.jsx)(y.Z,{value:"unclear",children:"Unclear"}),(0,b.jsx)(y.Z,{value:"",children:"Not Reviewed"})]}),(0,b.jsx)(S.Z,{className:"download-report-button",variant:"contained",color:"primary",onClick:function(){n?(be(!0),F({variables:{projectId:n,startDate:_e?(0,D.Z)(_e,"yyyy-MM-dd"):null,endDate:Ce?(0,D.Z)(Ce,"yyyy-MM-dd"):null,status:Ie||null}}).then((function(e){var n=e.data.generateTSApprovalReport;if(200===n.status&&n.file){var s=n.file.split(",")[1],r=Ee(s,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");(0,x.saveAs)(r,"training-sessions-report.xlsx"),j.Am.success("Download started.")}else j.Am.error(n.message||"Failed to generate report.");be(!1)})).catch((function(e){console.error("Error generating report:",e),j.Am.error("An error occurred while generating the report."),be(!1)}))):j.Am.error("No project selected.")},disabled:Ze,children:Ze?"Downloading...":"Download Report"})]}),Je?(0,b.jsx)("div",{className:"no__data",children:(0,b.jsx)("h1",{style:{fontSize:"20px"},children:"Currently, there are no sessions to review. \ud83c\udf89"})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"review-sessions-title",children:"Review Sessions"}),(0,b.jsx)("div",{className:"session-list",children:O.slice(0,5).map((function(e){var n,s=(null===e||void 0===e||null===(n=e.session_image_url)||void 0===n?void 0:n.split("/").slice(-2))||[],a=(0,i.Z)(s,2),l=a[0],c=a[1];return(0,b.jsxs)("div",{className:"session-item",children:[(0,b.jsxs)("div",{className:"session-image",children:[le[c]&&(0,b.jsx)(I.Z,{}),(0,b.jsx)("img",{src:null!==e&&void 0!==e&&e.session_image_url?"".concat("https://api.pima.ink","/image/").concat(l,"/").concat(c):null,alt:"Session",onClick:function(){return function(e,n){ve("".concat("https://api.pima.ink","/image/").concat(e,"/").concat(n))}(l,c)}})]}),(0,b.jsxs)("div",{className:"session-details",children:[(0,b.jsx)("h3",{children:e.training_module_name}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Trainer:"})," ",e.farmer_trainer_name]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Total Attendance:"})," ",e.total_attendance]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Male Attendance:"})," ",e.male_attendance]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Female Attendance:"})," ",e.female_attendance]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Training Date:"})," ",(0,D.Z)(new Date(e.session_date),"MMMM dd, yyyy")]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Training Group Name:"})," ",e.tg_name]})]}),(0,b.jsxs)("div",{className:"actions-column",children:[(0,b.jsx)("div",{className:"review-actions",children:(0,b.jsxs)("select",{onChange:function(n){return function(e,n){$((function(s){return(0,t.Z)((0,t.Z)({},s),{},(0,r.Z)({},e,n))}))}(e.id,n.target.value)},children:[(0,b.jsx)("option",{value:"",children:"-- Select --"}),(0,b.jsx)("option",{value:"approved",children:"Correct"}),(0,b.jsx)("option",{value:"invalid",children:"Incorrect"}),(0,b.jsx)("option",{value:"unclear",children:"Unclear"})]})}),(0,b.jsx)("button",{className:"view-map-button",onClick:function(){return function(e){te(e),ee(!0)}(e)},children:"View Map"})]})]},e.id)}))}),(0,b.jsx)("button",{className:"submit-button",onClick:function(){if(ze()){var e=Object.entries(Y).map((function(e){var n=(0,i.Z)(e,2);return{sessionId:n[0],status:n[1],userId:s}}));e.length?(he(!0),L({variables:{input:e}}).then((function(){$({}),z(),he(!1),j.Am.success("Batch submitted successfully!")})).catch((function(e){he(!1),console.error("Error submitting batch:",e),j.Am.error("An error occurred while submitting the batch.")}))):j.Am.error("Please select at least one session to submit.")}else j.Am.error("Please review all sessions before submitting.")},disabled:ue||!ze(),children:ue?"Submitting...":"Submit Batch"})]}),X&&(0,b.jsx)("div",{className:"modal-overlay",children:(0,b.jsxs)("div",{className:"modal",children:[(0,b.jsxs)("div",{className:"modal-header",children:[(0,b.jsx)("h2",{children:re?re.training_module_name:"Map View"}),(0,b.jsx)("button",{onClick:function(){return ee(!1)},className:"modal-close-button",children:"\xd7"})]}),(0,b.jsxs)("div",{className:"modal-content",children:[(0,b.jsx)("div",{className:"map-toolbar"}),(0,b.jsx)("div",{className:"map-container",children:(0,b.jsxs)(d.h,{center:Fe,zoom:6,scrollWheelZoom:!1,style:{height:"500px",width:"100%"},whenCreated:function(e){return je.current=e},children:[(0,b.jsx)(u.I,{url:"https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v11/tiles/512/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoieW11Z2VuZ2EiLCJhIjoiY20xN3NhOWJwMHFvcTJsc2Iyc2Z0Znd0aCJ9.A3EBUziAdNrV3nwrGvkv3g",attribution:'Map data \xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors | Imagery \xa9 <a href="https://www.mapbox.com/">Mapbox</a>'}),(0,b.jsx)(h.J,{position:Fe,icon:Re,children:(0,b.jsxs)(m.G,{className:"custom-popup",children:[(0,b.jsx)("h3",{children:"Training Session Location"}),(0,b.jsx)("p",{children:re?re.location:"San Francisco"})]})})]})})]})]})}),xe&&(0,b.jsx)("div",{className:"image-modal",onClick:function(){ve(null)},children:(0,b.jsx)("img",{src:xe,alt:"Fullscreen Farm Visit"})})]})}}}]);
//# sourceMappingURL=608.b4855845.chunk.js.map