"use strict";(self.webpackChunkmypima_front=self.webpackChunkmypima_front||[]).push([[436],{30589:(e,s,t)=>{t.d(s,{A:()=>f});var i=t(65043),a=t(73216),n=t(58786),o=t(67805),r=t(3438),l=t(85369),d=t(68926),c=t(11238),m=t(88250);const _=()=>{const e=new Date,s=Intl.DateTimeFormat().resolvedOptions().timeZone;return`${e.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})}_at_${e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:s})}`};var u=t(45476),p=t(84548),g=t(70579);const h={rows:{style:{minHeight:"30px",cursor:"pointer"}},headCells:{style:{paddingLeft:"8px",paddingRight:"8px",backgroundColor:"#1b2a4e",color:"white"}},cells:{style:{paddingLeft:"5px",paddingRight:"5px",paddingTop:"5px",paddingBottom:"5px"}}},x=e=>{let{handleCSVExport:s,handleExcelExport:t,tableRowItem:i}=e;return(0,g.jsxs)("div",{className:"export-buttons",children:["trainsessionapprov"!==i&&(0,g.jsxs)(r.A,{variant:"outlined",sx:{color:"#1b2a4e",borderColor:"#1b2a4e"},onClick:s,children:[(0,g.jsx)(l.Mbn,{style:{marginRight:"5px"}})," CSV"]}),(0,g.jsxs)(r.A,{variant:"outlined",sx:{color:"#1b2a4e",borderColor:"#1b2a4e"},onClick:t,children:[(0,g.jsx)(l.Mbn,{style:{marginRight:"5px"}}),"trainsessionapprov"!==i?"Excel":"Download Report"]})]})},f=e=>{let{columns:s,data:t,filter:l,tableRowItem:f,allAttendances:j,selectedProject:b}=e;const v=f||window.location.pathname.split("/")[2],[y,A]=(0,i.useState)({ts_id:null}),[S,C]=(0,i.useState)(!1),[w,I]=(0,i.useState)(!1),[k,E]=(0,i.useState)(null),[N,M]=(0,i.useState)(""),[R,T]=(0,i.useState)([]),[$,D]=(0,i.useState)(!1),[O,F]=(0,i.useState)(null),L=(0,a.Zp)(),P=(0,m.I)(p.jq,{variables:{tsId:y&&y.ts_id?y.ts_id:""},skip:!y}),V="traingroup"===v?"mypima_training_group":"trainsession"===v?"mypima_training_session":"participants"===v?"Participants Data":"farmvisit"===v?"mypima_farm_visit":"mypima_attendance";(0,i.useEffect)((()=>{var e,s;P.loading||200!==(null===(e=P.data)||void 0===e||null===(s=e.trainingSessionImage)||void 0===s?void 0:s.status)||(I(!1),E(P.data.trainingSessionImage.trainingSessionImage))}),[P]);return(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{className:"table-header-actions "+(l?"":"no-filter"),children:[l&&(0,g.jsx)(r.A,{className:"filter-button",children:"Filter"}),(0,g.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,g.jsxs)("div",{className:"search-container",children:[(0,g.jsx)("input",{type:"text",placeholder:"Search...",value:N,onChange:e=>{const i=e.target.value.toLowerCase(),a=t.filter((e=>s.some((s=>{const t=e[s.id];return null===t||void 0===t?void 0:t.toString().toLowerCase().includes(i)}))));T(a),M(e.target.value)}}),(0,g.jsx)("span",{className:"search-icon",children:(0,g.jsx)(o.LUJ,{})})]}),(0,g.jsx)(x,{handleCSVExport:()=>{if(!t||0===t.length)return void alert("No data available for export.");let e=[...s];if("farmvisit"===v){const s=[{id:"household_tns_id"},{id:"pima_farmer_id"},{id:"pima_household_id"}];e=[...e,...s]}const i=["num","Project","first_name","middle_name","last_name","gender","age","coffee_tree_numbers","number_of_coffee_plots","phone_number","a0EOj000002FMGnMAO"===b||"a0EOj000002C7ivMAC"===b?"national_identification_id":"a0EOj000003E0knMAC"===b?"growers_number":"coop_membership_number","location","farmer_sf_id","tns_id","hh_number","sf_household_id","farmer_number","ffg_id","training_group","status","farmer_trainer","a0EOj000003E0knMAC"===b?"agronomy_advisor":"business_advisor","create_in_commcare"];if("participants"===f){const e=new Map;j.filter((e=>t.some((s=>s.p_id===e.participant_id)))).forEach((s=>{const{attendance_status:t,participant_id:i,module_number:a,module_name:n,module_id:o}=s,r=`${a}-${n}-${o}`;e.has(r)||e.set(r,{});e.get(r)[i]="Present"===t?"1":"0"}));for(const[t]of e)i.push(t);const s=N.length>0?R.map((s=>{const t={...s};for(const[i,a]of e)t[i]=a[s.p_id]||"";return t})):t.map((s=>{const t={...s};for(const[i,a]of e)t[i]=a[s.p_id]||"";return t}));t=s}const a=t.map((e=>{let{tg_id:s,ts_id:t,p_id:i,attendance_id:a,fv_id:n,__typename:o,...r}=e;return r})),n=(0,d.df)({filename:V,columnHeaders:"participants"===f?i:e.map((e=>e.id))}),o=(0,d.Y_)(n)(a);o?((0,d.RG)(n)(o),console.log("Download successful"),console.log("Config:",n),console.log("Data:",t),console.log("CSV Content:",o)):console.error("Output is empty. Is your data formatted correctly?")},handleExcelExport:()=>{const e={header:s.map((e=>e.id)),body:t.map((e=>{let{tg_id:s,ts_id:t,p_id:i,attendance_id:a,fv_id:n,__typename:o,...r}=e;return Object.values(r)}))},i=t.reduce(((e,s)=>{let{farmer_trainer:t,session_image_status:i}=s;const a=`${t}_${i}`;return e[a]||(e[a]={farmer_trainer:t,session_image_status:i,count:0}),e[a].count+=1,e}),{}),a={header:["farmer_trainer","session_image_status","count"],body:Object.values(i).map((e=>Object.values(e)))},n=c.Wp.book_new(),o=c.Wp.json_to_sheet([e.header,...e.body],{skipHeader:!0}),r=c.Wp.json_to_sheet([a.header,...a.body],{skipHeader:!0});c.Wp.book_append_sheet(n,r,"Summary by Trainer"),c.Wp.book_append_sheet(n,o,"Sessions Data"),(0,c._h)(n,`${V}_${_()}.xlsx`)},tableRowItem:f})]})]}),(0,g.jsx)(n.Ay,{columns:s,data:N.length>0?R:t,onRowClicked:e=>{A(e);const s={trainsession:e.ts_id,traingroup:e.tg_id,participants:e.p_id,farmvisit:e.fv_ids,trainsessionapprov:e.ts_id}[f]||e.attendance_id;"farmvisit"!==f&&"trainsessionapprov"!==f?L(`/in/${f}/${s}`):"farmvisit"===f?(F(e.fv_id),D(!0)):"trainsessionapprov"===f&&(C(!0),I(!0))},pagination:!0,highlightOnHover:!0,customStyles:h,className:"table-container"}),S&&(0,g.jsx)(u.A,{open:S,handleClose:()=>C(!1),id:y.ts_id,data:y,isVerified:y.is_verified,imageStatus:y.session_image_status,sessionImageUrl:k,selectedProject:b,loading:w})]})}},40436:(e,s,t)=>{t.r(s),t.d(s,{default:()=>u});var i=t(65043),a=t(88250),n=t(43845),o=t(94496),r=t(30589),l=t(23768),d=t(84548),c=t(32393),m=t(73216),_=t(70579);const u=()=>{const{activeProject:e}=(0,m.KC)(),[s,t]=(0,i.useState)([]),{data:u,error:p,loading:g}=(0,a.I)(d.a8,{variables:{sfProjectId:e}});(0,i.useEffect)((()=>{if(u){const e=u.trainingSessionsByProject;t(200===e.status?e.trainingSessions:[])}p&&l.oR.error(p.message)}),[u,p]);const h=[{id:"num",name:"No.",selector:e=>e.num,sortable:!0,grow:1},{id:"ts_module",name:"Session Name",selector:e=>e.ts_module,sortable:!0,grow:2},{id:"ts_group",name:"Training Group",selector:e=>e.ts_group,sortable:!0,grow:2},{id:"tns_id",name:"TNS ID",selector:e=>e.tns_id,sortable:!0},{id:"farmer_trainer",name:"Farmer Trainer",selector:e=>e.farmer_trainer,sortable:!0,grow:2},{id:"total_males",name:"MA",selector:e=>e.total_males,sortable:!0,grow:1},{id:"total_females",name:"FA",selector:e=>e.total_females,sortable:!0,grow:1},{id:"has_image",name:"Has Image?",selector:e=>(0,_.jsx)("div",{children:e.has_image?(0,_.jsx)(n.A,{label:"Yes",color:"success",variant:"outlined"}):(0,_.jsx)(n.A,{label:"No",color:"error",variant:"outlined"})}),sortable:!0},{id:"is_verified",name:"Is Session Verified?",selector:e=>(0,_.jsx)("div",{children:e.is_verified?(0,_.jsx)(n.A,{label:"Yes",color:"success",variant:"outlined"}):(0,_.jsx)(n.A,{label:"No",color:"error",variant:"outlined"})}),sortable:!0},{id:"session_image_status",name:"Session Image Status",grow:2,selector:e=>(0,_.jsx)("div",{children:e.is_verified?(0,_.jsx)(n.A,{label:e.session_image_status,color:"success",variant:"outlined",title:e.session_image_status}):(0,_.jsx)(n.A,{label:"not_verified",color:"secondary",variant:"outlined",title:"not_verified"})}),sortable:!0},{id:"session_date",name:"Session Date",selector:e=>e.session_date,sortable:!0,grow:2}],x=s?s.map(((e,s)=>({num:s+1,ts_id:e.ts_id,ts_name:e.ts_name,ts_module:e.ts_module,ts_group:e.ts_group,tns_id:e.tns_id||"N/A",farmer_trainer:e.farmer_trainer,ts_status:e.ts_status,total_males:e.total_males,total_females:e.total_females,has_image:e.has_image,is_verified:e.is_verified,session_image_status:e.session_image_status,session_date:e.session_date}))):[];return g?(0,_.jsx)(c.A,{}):p?(0,_.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,_.jsx)(o.A,{color:"error",children:"Error loading data"})}):(0,_.jsxs)("div",{className:"page__container",children:[(0,_.jsx)("h1",{className:"module__heading",children:"Training Sessions View"}),s.length>0?(0,_.jsx)(r.A,{columns:h,data:x,tableRowItem:"trainsession"}):(0,_.jsx)("div",{className:"no__data",children:(0,_.jsx)("h1",{style:{fontSize:"20px"},children:"No Training Sessions Yet"})})]})}},45476:(e,s,t)=>{t.d(s,{A:()=>p});var i=t(65043),a=t(83462),n=t(17392),o=t(81637),r=t(94496),l=t(35316),d=t(68903),c=t(27149),m=t(34535),_=t(70579);const u=(0,m.Ay)("div")({position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"}),p=e=>{let{open:s,handleClose:t,sessionImageUrl:m,data:p,selectedProject:g,loading:h}=e;console.log(p);const[x,f]=(0,i.useState)(!1),[j]=(0,i.useState)(!1),b=()=>{f((e=>!e))};return(0,_.jsx)(_.Fragment,{children:h?(0,_.jsxs)(a.A,{open:s,keepMounted:!0,fullWidth:!0,"aria-describedby":"alert-dialog-slide-description",children:[(0,_.jsx)("div",{style:{margin:"20px"},children:(0,_.jsx)(n.A,{"aria-label":"close",onClick:t,sx:{position:"absolute",right:8,top:8,color:"#2b2b2b"},children:(0,_.jsx)(c.m6K,{})})}),(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[(0,_.jsx)(o.A,{}),(0,_.jsx)(r.A,{variant:"h6",style:{marginLeft:"10px"},children:"Loading Image..."})]})]}):(0,_.jsxs)(a.A,{open:s,keepMounted:!0,fullWidth:!0,"aria-describedby":"alert-dialog-slide-description",children:[j&&(0,_.jsx)(u,{children:(0,_.jsx)(o.A,{})}),(0,_.jsxs)("div",{style:{margin:"20px"},children:[(0,_.jsx)(n.A,{"aria-label":"close",onClick:t,sx:{position:"absolute",right:8,top:8,color:"#2b2b2b"},children:(0,_.jsx)(c.m6K,{})}),(0,_.jsx)(r.A,{variant:"h6",children:"Session Image"})]}),(0,_.jsx)(l.A,{children:(0,_.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,_.jsxs)(d.Ay,{item:!0,xs:12,sm:6,children:[(0,_.jsxs)(r.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Male Attendees:"})," ",p.total_males]}),(0,_.jsxs)(r.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Female Attendees:"})," ",p.total_females]}),(0,_.jsxs)(r.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Total Attendees:"})," ",p.total_males+p.total_females]}),(0,_.jsxs)(r.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Session Date:"})," ",p.session_date]}),(0,_.jsxs)(r.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Farmer Trainer:"})," ",p.farmer_trainer]}),(0,_.jsxs)(r.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Session Module:"})," ",p.ts_module]}),(0,_.jsxs)(r.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"FFG:"})," ",p.ts_group]})]}),(0,_.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,_.jsxs)("div",{style:{position:"relative"},children:[(0,_.jsx)("img",{src:m,alt:"session_pic",style:{width:"100%",height:"auto",cursor:x?"zoom-out":"zoom-in"},onClick:b}),x?(0,_.jsx)(n.A,{"aria-label":"shrink",onClick:b,sx:{position:"absolute",bottom:8,right:8,color:"#fff"},children:(0,_.jsx)(c.Llp,{})}):(0,_.jsx)(n.A,{"aria-label":"expand",onClick:b,sx:{position:"absolute",bottom:8,right:8,color:"#fff"},children:(0,_.jsx)(c.T$Z,{})})]})})]})})]})})}}}]);
//# sourceMappingURL=436.08d3a795.chunk.js.map