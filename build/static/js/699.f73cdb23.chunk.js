"use strict";(self.webpackChunkmypima_front=self.webpackChunkmypima_front||[]).push([[699],{4699:(e,s,n)=>{n.r(s),n.d(s,{default:()=>M});var t=n(65043),r=n(88250),a=n(6410),i=n(31881),l=n(99419),o=n(12023),c=n(76036),d=n(13318),h=n(80228),u=n(72450),m=n(84548),x=n(23768),p=n(21548),j=n(27149),v=n(2127),g=n(70579);const f=e=>{let{sampledSessions:s}=e;const n=[{heading:"Total Sampled",figures:s.length,icon:(0,g.jsx)(j.Itr,{}),color:"#25245D"},{heading:"Total Reviewed",figures:s.filter((e=>null!==e.image_review_result)).length,icon:(0,g.jsx)(j.Itr,{}),color:"#087C8F"},{heading:"Not Reviewed",figures:s.filter((e=>null===e.image_review_result)).length,icon:(0,g.jsx)(v.qYD,{}),color:"#25245D"}];return(0,g.jsxs)("div",{style:{width:"100%",marginBottom:"20px",display:"flex"},children:[n.map(((e,s)=>(0,g.jsx)("div",{children:(0,g.jsx)(p.A,{heading:e.heading,figures:e.figures,icon:e.icon,color:e.color})},s)))," "]})};var w=n(94496),b=n(67784),_=n(32143),y=n(3438),N=n(58390),A=n(13130),S=n(56138),C=n(33498),I=n(39993),k=n(32393),R=n(73216);const M=()=>{const{activeProject:e,userId:s}=(0,R.KC)(),{data:n,loading:p,error:j,refetch:v}=(0,r.I)(m.Y8,{variables:{projectId:e},fetchPolicy:"network-only"}),[M]=(0,a._)(m.RA,{fetchPolicy:"network-only"}),[D,T]=(0,t.useState)([]),[z,E]=(0,t.useState)([]),[F]=(0,i.n)(m.YI),[B,J]=(0,t.useState)({}),[P,U]=(0,t.useState)(!1),[V,Z]=(0,t.useState)(null),[$,O]=(0,t.useState)({}),[W,Y]=(0,t.useState)(!1),[G,L]=(0,t.useState)(null),q=(0,t.useRef)(null),[H,K]=(0,t.useState)(!1),[Q,X]=(0,t.useState)((0,C.A)(new Date,1)),[ee,se]=(0,t.useState)(new Date),[ne,te]=(0,t.useState)("approved");(0,t.useEffect)((()=>{P&&q.current&&setTimeout((()=>{q.current.invalidateSize()}),300)}),[P]),(0,t.useEffect)((()=>{if(n){T(n.sampledTrainingSessions);const e=n.sampledTrainingSessions.reduce(((e,s)=>(e[s.id]=!0,e)),{});O(e);const s=n.sampledTrainingSessions.filter((e=>null===e.image_review_result));E(s)}}),[n]);const re=()=>z.slice(0,5).every((e=>B[e.id])),ae=(e,s)=>{const n=atob(e),t=[];for(let r=0;r<n.length;r+=512){const e=n.slice(r,r+512),s=new Array(e.length);for(let n=0;n<e.length;n++)s[n]=e.charCodeAt(n);const a=new Uint8Array(s);t.push(a)}return new Blob(t,{type:s})},ie=V?{lat:V.ts_latitude,lng:V.ts_longitude}:{lat:-1.2921,lng:36.8219},le=(0,h.icon)({iconUrl:"https://img.icons8.com/?size=100&id=60013&format=png&color=000000",iconSize:[35,35],iconAnchor:[22,94],popupAnchor:[-3,-76]});if(p)return(0,g.jsx)(k.A,{});if(j)return(0,g.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,g.jsx)(w.A,{color:"error",children:"Error loading data"})});const oe=0===z.length;return(0,g.jsxs)("div",{className:"training-session-app",children:[(0,g.jsxs)("div",{className:"dashboard",children:[(0,g.jsx)("h1",{className:"dashboard-title",children:"Training Session Overview"}),(0,g.jsx)(f,{sampledSessions:D})]}),(0,g.jsxs)("div",{className:"report-controls",children:[(0,g.jsx)(N.$,{dateAdapter:S.h,children:(0,g.jsxs)("div",{className:"date-controls",children:[(0,g.jsx)(A.l,{label:"Start Date",value:Q,onChange:e=>X(e),renderInput:e=>(0,g.jsx)(b.A,{...e})}),(0,g.jsx)(A.l,{label:"End Date",value:ee,onChange:e=>se(e),renderInput:e=>(0,g.jsx)(b.A,{...e})})]})}),(0,g.jsxs)(b.A,{className:"status-select",label:"Status",select:!0,value:ne,onChange:e=>te(e.target.value),variant:"outlined",children:[(0,g.jsx)(_.A,{value:"all",children:"All"}),(0,g.jsx)(_.A,{value:"approved",children:"Correct"}),(0,g.jsx)(_.A,{value:"invalid",children:"Incorrect"}),(0,g.jsx)(_.A,{value:"unclear",children:"Unclear"}),(0,g.jsx)(_.A,{value:"",children:"Not Reviewed"})]}),(0,g.jsx)(y.A,{className:"download-report-button",variant:"contained",color:"primary",onClick:()=>{e?(K(!0),M({variables:{projectId:e,startDate:Q?(0,I.A)(Q,"yyyy-MM-dd"):null,endDate:ee?(0,I.A)(ee,"yyyy-MM-dd"):null,status:ne||null}}).then((e=>{const{generateTSApprovalReport:s}=e.data;if(200===s.status&&s.file){const e=s.file.split(",")[1],n=ae(e,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");(0,u.saveAs)(n,"training-sessions-report.xlsx"),x.oR.success("Download started.")}else x.oR.error(s.message||"Failed to generate report.");K(!1)})).catch((e=>{console.error("Error generating report:",e),x.oR.error("An error occurred while generating the report."),K(!1)}))):x.oR.error("No project selected.")},disabled:H,children:H?"Downloading...":"Download Report"})]}),oe?(0,g.jsx)("div",{className:"no__data",children:(0,g.jsx)("h1",{style:{fontSize:"20px"},children:"Currently, there are no sessions to review. \ud83c\udf89"})}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("h2",{className:"review-sessions-title",children:"Review Sessions"}),(0,g.jsx)("div",{className:"session-list",children:z.slice(0,5).map((e=>{var s;const[n,t]=(null===e||void 0===e||null===(s=e.session_image_url)||void 0===s?void 0:s.split("/").slice(-2))||[];return(0,g.jsxs)("div",{className:"session-item",children:[(0,g.jsxs)("div",{className:"session-image",children:[$[t]&&(0,g.jsx)(k.A,{}),(0,g.jsx)("img",{src:null!==e&&void 0!==e&&e.session_image_url?`http://localhost:6500/image/${n}/${t}`:null,alt:"Session",onClick:()=>((e,s)=>{L(`http://localhost:6500/image/${e}/${s}`)})(n,t)})]}),(0,g.jsxs)("div",{className:"session-details",children:[(0,g.jsx)("h3",{children:e.training_module_name}),(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"Trainer:"})," ",e.farmer_trainer_name]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"Total Attendance:"})," ",e.total_attendance]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"Male Attendance:"})," ",e.male_attendance]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"Female Attendance:"})," ",e.female_attendance]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"Training Date:"})," ",(0,I.A)(new Date(e.session_date),"MMMM dd, yyyy")]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"Training Group Name:"})," ",e.tg_name]})]}),(0,g.jsxs)("div",{className:"actions-column",children:[(0,g.jsx)("div",{className:"review-actions",children:(0,g.jsxs)("select",{onChange:s=>((e,s)=>{J((n=>({...n,[e]:s})))})(e.id,s.target.value),children:[(0,g.jsx)("option",{value:"",children:"-- Select --"}),(0,g.jsx)("option",{value:"approved",children:"Correct"}),(0,g.jsx)("option",{value:"invalid",children:"Incorrect"}),(0,g.jsx)("option",{value:"unclear",children:"Unclear"})]})}),(0,g.jsx)("button",{className:"view-map-button",onClick:()=>(e=>{Z(e),U(!0)})(e),children:"View Map"})]})]},e.id)}))}),(0,g.jsx)("button",{className:"submit-button",onClick:()=>{if(!re())return void x.oR.error("Please review all sessions before submitting.");const e=Object.entries(B).map((e=>{let[n,t]=e;return{sessionId:n,status:t,userId:s}}));e.length?(Y(!0),F({variables:{input:e}}).then((()=>{J({}),v(),Y(!1),x.oR.success("Batch submitted successfully!")})).catch((e=>{Y(!1),console.error("Error submitting batch:",e),x.oR.error("An error occurred while submitting the batch.")}))):x.oR.error("Please select at least one session to submit.")},disabled:W||!re(),children:W?"Submitting...":"Submit Batch"})]}),P&&(0,g.jsx)("div",{className:"modal-overlay",children:(0,g.jsxs)("div",{className:"modal",children:[(0,g.jsxs)("div",{className:"modal-header",children:[(0,g.jsx)("h2",{children:V?V.training_module_name:"Map View"}),(0,g.jsx)("button",{onClick:()=>U(!1),className:"modal-close-button",children:"\xd7"})]}),(0,g.jsxs)("div",{className:"modal-content",children:[(0,g.jsx)("div",{className:"map-toolbar"}),(0,g.jsx)("div",{className:"map-container",children:(0,g.jsxs)(l.W,{center:ie,zoom:6,scrollWheelZoom:!1,style:{height:"500px",width:"100%"},whenCreated:e=>q.current=e,children:[(0,g.jsx)(o.e,{url:"https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v11/tiles/512/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoieW11Z2VuZ2EiLCJhIjoiY20xN3NhOWJwMHFvcTJsc2Iyc2Z0Znd0aCJ9.A3EBUziAdNrV3nwrGvkv3g",attribution:'Map data \xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors | Imagery \xa9 <a href="https://www.mapbox.com/">Mapbox</a>'}),(0,g.jsx)(c.p,{position:ie,icon:le,children:(0,g.jsxs)(d.z,{className:"custom-popup",children:[(0,g.jsx)("h3",{children:"Training Session Location"}),(0,g.jsx)("p",{children:V?V.location:"San Francisco"})]})})]})})]})]})}),G&&(0,g.jsx)("div",{className:"image-modal",onClick:()=>{L(null)},children:(0,g.jsx)("img",{src:G,alt:"Fullscreen Farm Visit"})})]})}},21548:(e,s,n)=>{n.d(s,{A:()=>r});n(65043);var t=n(70579);const r=e=>{let{heading:s,figures:n,icon:r,color:a}=e;return(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"card__container",children:(0,t.jsxs)("div",{className:"card__content",children:[(0,t.jsxs)("div",{className:"card__text",children:[(0,t.jsx)("p",{className:"card__text1",children:s}),(0,t.jsx)("p",{className:"card__text2",children:n})]}),(0,t.jsxs)("div",{className:"card__icon",style:{backgroundColor:a},children:[r," "]})]})})})}}}]);
//# sourceMappingURL=699.f73cdb23.chunk.js.map