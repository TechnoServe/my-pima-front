"use strict";(self.webpackChunkmypima_front=self.webpackChunkmypima_front||[]).push([[608],{50284:function(e,n,s){s(72791);var i=s(13239),t=s(80184);n.Z=function(){return(0,t.jsxs)("div",{className:"circular_progress",children:[(0,t.jsxs)("div",{className:"spinner-container",children:[(0,t.jsx)("div",{className:"spinner-glow"}),(0,t.jsx)(i.Z,{className:"spinner",size:80,thickness:4.5,style:{color:"#1b2a4e"}})]}),(0,t.jsx)("h2",{children:"Loading Data..."})]})}},59898:function(e,n,s){s.d(n,{Z:function(){return t}});s(72791);var i=s(80184),t=function(e){var n=e.heading,s=e.figures,t=e.icon,a=e.color;return(0,i.jsx)("div",{children:(0,i.jsx)("div",{className:"card__container",children:(0,i.jsxs)("div",{className:"card__content",children:[(0,i.jsxs)("div",{className:"card__text",children:[(0,i.jsx)("p",{className:"card__text1",children:n}),(0,i.jsx)("p",{className:"card__text2",children:s})]}),(0,i.jsxs)("div",{className:"card__icon",style:{backgroundColor:a},children:[t," "]})]})})})}},85608:function(e,n,s){s.r(n),s.d(n,{default:function(){return k}});var i=s(93433),t=s(4942),a=s(1413),r=s(29439),c=s(72791),o=s(32543),l=s(84376),d=s(69961),u=s(17626),m=s(6042),h=s(59500),p=s(78559),v=s(64802),x=s(96019),g=s(65218),j=s(59898),f=s(16856),_=s(39126),b=s(80184),w=function(e){var n=e.sampledSessions,s=[{heading:"Total Sampled",figures:n.length,icon:(0,b.jsx)(f.te,{}),color:"#25245D"},{heading:"Total Reviewed",figures:n.filter((function(e){return null!==e.image_review_result})).length,icon:(0,b.jsx)(f.te,{}),color:"#087C8F"},{heading:"Not Reviewed",figures:n.filter((function(e){return null===e.image_review_result})).length,icon:(0,b.jsx)(_.gW$,{}),color:"#25245D"}];return(0,b.jsxs)("div",{style:{width:"100%",marginBottom:"20px",display:"flex"},children:[s.map((function(e,n){return(0,b.jsx)("div",{children:(0,b.jsx)(j.Z,{heading:e.heading,figures:e.figures,icon:e.icon,color:e.color})},n)}))," "]})},N=s(20890),y=s(50284),Z=s(8977),S=s(57299),k=function(e){var n=e.selectedProject,s=e.userId,j=(0,o.a)(x.MQ,{variables:{projectId:n},fetchPolicy:"network-only"}),f=j.data,_=j.loading,k=j.error,A=j.refetch,C=(0,c.useState)([]),M=(0,r.Z)(C,2),T=M[0],I=M[1],P=(0,c.useState)([]),D=(0,r.Z)(P,2),F=D[0],z=D[1],E=(0,l.D)(x.jb),B=(0,r.Z)(E,1)[0],J=(0,c.useState)({}),R=(0,r.Z)(J,2),O=R[0],U=R[1],V=(0,c.useState)(!1),W=(0,r.Z)(V,2),G=W[0],L=W[1],H=(0,c.useState)(null),Q=(0,r.Z)(H,2),X=Q[0],Y=Q[1],$=(0,c.useState)({}),q=(0,r.Z)($,2),K=q[0],ee=q[1],ne=(0,c.useState)(!1),se=(0,r.Z)(ne,2),ie=se[0],te=se[1],ae=(0,c.useState)(null),re=(0,r.Z)(ae,2),ce=re[0],oe=re[1],le=(0,c.useRef)(null);(0,c.useEffect)((function(){G&&le.current&&setTimeout((function(){le.current.invalidateSize()}),300)}),[G]),(0,c.useEffect)((function(){if(f){I(f.sampledTrainingSessions);var e=f.sampledTrainingSessions.reduce((function(e,n){return e[n.id]=!0,e}),{});ee(e);var n=f.sampledTrainingSessions.filter((function(e){return null===e.image_review_result}));z(n)}}),[f]);var de=function(){return F.slice(0,5).every((function(e){return O[e.id]}))},ue=X?{lat:X.ts_latitude,lng:X.ts_longitude}:{lat:-1.2921,lng:36.8219},me=(0,p.icon)({iconUrl:"https://img.icons8.com/?size=100&id=9HuXC128p4_T&format=png&color=000000",iconSize:[35,35],iconAnchor:[22,94],popupAnchor:[-3,-76]});if(_)return(0,b.jsx)(y.Z,{});if(k)return(0,b.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,b.jsx)(N.Z,{color:"error",children:"Error loading data"})});var he=0===F.length;return(0,b.jsxs)("div",{className:"training-session-app",children:[(0,b.jsxs)("div",{className:"dashboard",children:[(0,b.jsx)("h1",{className:"dashboard-title",children:"Training Session Overview"}),(0,b.jsx)(w,{sampledSessions:T})]}),(0,b.jsx)("button",{className:"download-report-button",onClick:function(){if(T){var e=T.reduce((function(e,n){var s=n.farmer_trainer_name,i=n.image_review_result?n.image_review_result:"pending";return e[s]||(e[s]={approved:0,unclear:0,invalid:0,pending:0}),e[s][i]++,e}),{}),n=[["Farmer Trainer","Approved","Unclear","Invalid","Pending"]].concat((0,i.Z)(Object.entries(e).map((function(e){var n=(0,r.Z)(e,2),s=n[0],i=n[1];return[s,i.approved,i.unclear,i.invalid,i.pending]})))),s=[["Training Module","Trainer","Attendance","Male","Female","Group","Date","Image URL"]].concat((0,i.Z)(T.filter((function(e){return"approved"===e.image_review_result})).map((function(e){var n,s=(null===e||void 0===e||null===(n=e.session_image_url)||void 0===n?void 0:n.split("/").slice(-2))||[],i=(0,r.Z)(s,2),t=i[0],a=i[1];return[e.training_module_name,e.farmer_trainer_name,e.total_attendance,e.male_attendance,e.female_attendance,e.tg_name,(0,Z.Z)(new Date(e.session_date),"MMMM dd, yyyy"),"".concat("https://api.pima.ink","/image/").concat(t,"/").concat(a)]})))),t=S.P6.book_new(),a=S.P6.aoa_to_sheet(n),c=S.P6.aoa_to_sheet(s);S.P6.book_append_sheet(t,a,"Status Breakdown"),S.P6.book_append_sheet(t,c,"Approved Sessions");var o=S.cW(t,{bookType:"xlsx",type:"array"}),l=new Blob([o],{type:"application/octet-stream"});(0,v.saveAs)(l,"training-sessions-report.xlsx"),g.Am.success("Excel report generated successfully.")}else g.Am.error("No session data available to generate the report.")},children:"Download Excel Report"}),he?(0,b.jsx)("div",{className:"no__data",children:(0,b.jsx)("h1",{style:{fontSize:"20px"},children:"Currently, there are no sessions to review. \ud83c\udf89"})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"review-sessions-title",children:"Review Sessions"}),(0,b.jsx)("div",{className:"session-list",children:F.slice(0,5).map((function(e){var n,s=(null===e||void 0===e||null===(n=e.session_image_url)||void 0===n?void 0:n.split("/").slice(-2))||[],i=(0,r.Z)(s,2),c=i[0],o=i[1];return(0,b.jsxs)("div",{className:"session-item",children:[(0,b.jsxs)("div",{className:"session-image",children:[K[o]&&(0,b.jsx)(y.Z,{}),(0,b.jsx)("img",{src:null!==e&&void 0!==e&&e.session_image_url?"".concat("https://api.pima.ink","/image/").concat(c,"/").concat(o):null,alt:"Session",onClick:function(){return function(e,n){oe("".concat("https://api.pima.ink","/image/").concat(e,"/").concat(n))}(c,o)}})]}),(0,b.jsxs)("div",{className:"session-details",children:[(0,b.jsx)("h3",{children:e.training_module_name}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Trainer:"})," ",e.farmer_trainer_name]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Total Attendance:"})," ",e.total_attendance]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Male Attendance:"})," ",e.male_attendance]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Female Attendance:"})," ",e.female_attendance]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Training Date:"})," ",(0,Z.Z)(new Date(e.session_date),"MMMM dd, yyyy")]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Training Group Name:"})," ",e.tg_name]})]}),(0,b.jsxs)("div",{className:"actions-column",children:[(0,b.jsx)("div",{className:"review-actions",children:(0,b.jsxs)("select",{onChange:function(n){return s=e.id,i=n.target.value,void U((function(e){return(0,a.Z)((0,a.Z)({},e),{},(0,t.Z)({},s,i))}));var s,i},children:[(0,b.jsx)("option",{value:"",children:"-- Select --"}),(0,b.jsx)("option",{value:"approved",children:"Correct"}),(0,b.jsx)("option",{value:"invalid",children:"Incorrect"}),(0,b.jsx)("option",{value:"unclear",children:"Unclear"})]})}),(0,b.jsx)("button",{className:"view-map-button",onClick:function(){return function(e){Y(e),L(!0)}(e)},children:"View Map"})]})]},e.id)}))}),(0,b.jsx)("button",{className:"submit-button",onClick:function(){if(de()){var e=Object.entries(O).map((function(e){var n=(0,r.Z)(e,2);return{sessionId:n[0],status:n[1],userId:s}}));e.length?(te(!0),B({variables:{input:e}}).then((function(){U({}),A(),te(!1),g.Am.success("Batch submitted successfully!")})).catch((function(e){te(!1),console.error("Error submitting batch:",e),g.Am.error("An error occurred while submitting the batch.")}))):g.Am.error("Please select at least one session to submit.")}else g.Am.error("Please review all sessions before submitting.")},disabled:ie||!de(),children:ie?"Submitting...":"Submit Batch"})]}),G&&(0,b.jsx)("div",{className:"modal-overlay",children:(0,b.jsxs)("div",{className:"modal",children:[(0,b.jsxs)("div",{className:"modal-header",children:[(0,b.jsx)("h2",{children:X?X.training_module_name:"Map View"}),(0,b.jsx)("button",{onClick:function(){return L(!1)},className:"modal-close-button",children:"\xd7"})]}),(0,b.jsxs)("div",{className:"modal-content",children:[(0,b.jsx)("div",{className:"map-toolbar"}),(0,b.jsx)("div",{className:"map-container",children:(0,b.jsxs)(d.h,{center:ue,zoom:6,scrollWheelZoom:!1,style:{height:"500px",width:"100%"},whenCreated:function(e){return le.current=e},children:[(0,b.jsx)(u.I,{url:"https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v11/tiles/512/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoieW11Z2VuZ2EiLCJhIjoiY20xN3NhOWJwMHFvcTJsc2Iyc2Z0Znd0aCJ9.A3EBUziAdNrV3nwrGvkv3g",attribution:'Map data \xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors | Imagery \xa9 <a href="https://www.mapbox.com/">Mapbox</a>'}),(0,b.jsx)(m.J,{position:ue,icon:me,children:(0,b.jsxs)(h.G,{className:"custom-popup",children:[(0,b.jsx)("h3",{children:"Training Session Location"}),(0,b.jsx)("p",{children:X?X.location:"San Francisco"})]})})]})})]})]})}),ce&&(0,b.jsx)("div",{className:"image-modal",onClick:function(){oe(null)},children:(0,b.jsx)("img",{src:ce,alt:"Fullscreen Farm Visit"})})]})}}}]);
//# sourceMappingURL=608.3b9fc846.chunk.js.map