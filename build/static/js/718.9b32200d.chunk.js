"use strict";(self.webpackChunkmypima_front=self.webpackChunkmypima_front||[]).push([[718],{3095:function(e,n,t){t.d(n,{Cb:function(){return p},Q8:function(){return u},U:function(){return m},w8:function(){return _}});var r,a,i,s,o,c,l=t(30168),d=t(9383),u=((0,d.Ps)(r||(r=(0,l.Z)(["\n  query GetParticipantsAttendanceByProject($projectId: String!) {\n    getParticipantsByProject(project_id: $projectId) {\n      message\n      status\n      participants {\n        p_id\n        first_name\n        middle_name\n        last_name\n        gender\n        age\n        coffee_tree_numbers\n        coop_membership_number\n        phone_number\n        hh_number\n        ffg_id\n        location\n        tns_id\n        status\n        farmer_trainer\n        business_advisor\n        project_name\n        training_group\n        household_id\n        primary_household_member\n        create_in_commcare\n      }\n    }\n    getAttendances(project_id: $projectId) {\n      message\n      status\n      attendance {\n        attendance_id\n        participant_id\n        attendance_name\n        attendance_date\n        attendance_status\n        session_id\n        module_name\n        module_number\n        module_id\n      }\n    }\n  }\n"]))),(0,d.Ps)(a||(a=(0,l.Z)(["\n  query GetParticipantsAttendanceByProject($projectId: String!) {\n    getParticipantsByProject(project_id: $projectId) {\n      message\n      status\n      participants {\n        p_id\n        first_name\n        middle_name\n        last_name\n        gender\n        age\n        coffee_tree_numbers\n        number_of_coffee_plots\n        coop_membership_number\n        phone_number\n        hh_number\n        ffg_id\n        location\n        tns_id\n        status\n        farmer_trainer\n        business_advisor\n        project_name\n        training_group\n        household_id\n        primary_household_member\n        create_in_commcare\n      }\n    }\n  }\n"])))),m=(0,d.Ps)(i||(i=(0,l.Z)(["\n  query GetParticipantsByGroup($tgId: String!) {\n    getParticipantsByGroup(tg_id: $tgId) {\n      message\n      status\n      participants {\n        p_id\n        first_name\n        middle_name\n        last_name\n        gender\n        location\n        tns_id\n        status\n        farmer_trainer\n        business_advisor\n        project_name\n        training_group\n        household_id\n        primary_household_member\n      }\n    }\n  }\n"]))),p=((0,d.Ps)(s||(s=(0,l.Z)(["\n  query GetAttendanceByParticipant($participantId: String!) {\n    getAttendanceByParticipant(participant_id: $participantId) {\n      message\n      status\n      attendance {\n        attendance_id\n        participant_id\n        attendance_name\n        attendance_date\n        attendance_status\n        session_id\n      }\n    }\n  }\n"]))),(0,d.Ps)(o||(o=(0,l.Z)(["\n  mutation UploadParticipants($partsFile: Upload!) {\n    uploadParticipants(parts_file: $partsFile) {\n      message\n      status\n      file\n    }\n  }\n"])))),_=(0,d.Ps)(c||(c=(0,l.Z)(["\n  mutation SyncParticipantsWithCOMMCARE($projectId: String!) {\n    syncParticipantsWithCOMMCARE(project_id: $projectId) {\n      message\n      status\n    }\n  }\n"])))},44879:function(e,n,t){t.r(n),t.d(n,{default:function(){return F}});var r,a=t(74165),i=t(15861),s=t(29439),o=t(72791),c=t(81918),l=t(65770),d=t(56355),u=t(93433),m=t(16029),p=t(20890),_=t(19658),f=t(94294),h=t(5289),g=t(39157),x=t(97123),j=t(21246),b=t(78820),v=t(7692),y=t(84376),Z=t(32543),P=t(64802),w=t(3095),S=t(80184),C=["Project","first_name","last_name","gender","age","coffee_tree_numbers","farmer_sf_id","tns_id","hh_number","sf_household_id","farmer_number","ffg_id","training_group","status"],k=function(e){var n,t,r=e.open,l=e.setOpen,k=e.navigatedProject,I=e.sfProjectId,N=(0,o.useState)(null),B=(0,s.Z)(N,2),A=B[0],F=B[1],D=(0,o.useState)(null),$=(0,s.Z)(D,2),O=($[0],$[1]),G=(0,o.useState)([]),z=(0,s.Z)(G,2),M=z[0],U=z[1],T=(0,o.useState)([]),E=(0,s.Z)(T,2),R=E[0],q=E[1],Q=(0,o.useState)(null),V=(0,s.Z)(Q,2),H=V[0],J=V[1],W=(0,o.useState)(!1),L=(0,s.Z)(W,2),K=L[0],Y=L[1],X=(0,y.D)(w.Cb),ee=(0,s.Z)(X,1)[0],ne=(0,Z.a)(w.Q8,{variables:{projectId:I}}),te=function(e){var n=new FileReader;n.onload=function(n){var t=n.target.result.split(/\r\n|\n/),r=t.map((function(e){return e.split(",").map((function(e){return e.replace(/^"(.*)"$/,"$1")}))}));F({filename:e.name,size:e.size,type:e.type,data:r.length>0?r:t}),U(r[0])},n.readAsText(e)};(0,o.useEffect)((function(){A&&(A.data&&A.data.length<2||re(A))}),[A,M]);var re=function(e){var n=e.data.map((function(e){return e[M.indexOf("Project")]})).filter((function(e){return e}));q((0,u.Z)(new Set(n)))},ae=function(e,n){"backdropClick"!==n&&"escapeKeyDown"!==n&&ie()},ie=function(){F(null),l(!1)},se=function(e,n,t){var r=n.indexOf("Project"),a=e.data.filter((function(e){return e[r]===t})),i="".concat(n.join(","),"\n").concat(a.join("\n"));return new File([i],e.filename,{type:"text/csv"})},oe=function(e){return(t=t||(0,i.Z)((0,a.Z)().mark((function e(n){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ee({variables:{partsFile:n}});case 3:return t=e.sent,e.next=6,ne.refetch();case 6:J(t.data.uploadParticipants),200===t.data.uploadParticipants.status&&setTimeout((function(){window.location.reload()}),5e3),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0),J({status:500,message:"Something went wrong. Please try again."});case 14:return e.prev=14,Y(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})))).apply(this,arguments)},ce=function(){var e=H.file;H.message;if(e){var n=atob(e),t=new Array(n.length).fill().map((function(e,t){return n.charCodeAt(t)})),r=new Uint8Array(t),a=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,P.saveAs)(a,"error_file.xlsx")}else console.error("No file found in the upload result.")},le=function(e){return e>1e6?"".concat((e/1e6).toFixed(2)," MB"):"".concat((e/1e3).toFixed(2)," KB")},de=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};return(0,S.jsxs)(h.Z,{open:r,onClose:ae,children:[(0,S.jsx)(g.Z,{children:A?H?(0,S.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},className:"file-info",children:[(0,S.jsx)(p.Z,{variant:"body2",children:(0,S.jsx)(_.Z,{severity:200===H.status?"success":"error",children:H.message})}),200!==H.status&&H.file&&(0,S.jsx)(f.Z,{onClick:ce,variant:"contained",color:"primary",children:"Download Error File"})]}):M.filter((function(e){return C.includes(e)})).length!==C.length?(0,S.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,S.jsxs)(p.Z,{variant:"body1",children:[(0,S.jsx)(v.tJu,{style:{fontSize:"2rem",color:"#B90101"}})," File must contain all required columns:"]}),(0,S.jsx)(p.Z,{variant:"body2",sx:{display:"flex",alignItems:"center",flexWrap:"wrap"},children:C.filter((function(e){return!M.includes(e)})).map((function(e,n){return(0,S.jsx)(c.Z,{label:e,sx:{margin:"5px 0.5rem"},color:"primary",variant:"outlined"},n)}))}),(0,S.jsx)("div",{className:"upload_actions",children:(0,S.jsx)(b.SV5,{onClick:function(){return F(null)},className:"back__icon",title:"Back to Upload New File"})})]}):A.data.length-2<1?(0,S.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,S.jsxs)(p.Z,{variant:"body1",sx:{fontStyle:"italic"},children:[(0,S.jsx)(v.tJu,{style:{fontSize:"1.5rem",color:"#B90101"}})," There are no records in the file. Please upload a file with data."]}),(0,S.jsx)("div",{className:"upload_actions",children:(0,S.jsx)(b.SV5,{onClick:function(){return F(null)},className:"back__icon",title:"Back to Upload New File"})})]}):R.includes(k)?(0,S.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},className:"file-info",children:[(0,S.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,S.jsxs)(p.Z,{variant:"body2",children:[(0,S.jsx)("strong",{children:"Name:"})," ",A.filename]}),(0,S.jsxs)(p.Z,{variant:"body2",children:[(0,S.jsx)("strong",{children:"Size:"})," ",le(A.size)]}),(0,S.jsxs)(p.Z,{variant:"body2",children:[(0,S.jsx)("strong",{children:"Type:"})," ",A.type]}),(0,S.jsxs)(p.Z,{variant:"body2",children:[(0,S.jsx)("strong",{children:"Total Records:"})," ",de(A.data.length-2)]}),R.length>1&&(0,S.jsxs)(p.Z,{variant:"body4",sx:{marginBottom:"10px"},children:["Only records for ",(0,S.jsxs)("strong",{children:[k," (",A.data.filter((function(e){return e[M.indexOf("Project")]===k})).length," records)"]})," will be processed from this file."]})]}),(0,S.jsx)("div",{className:"upload_actions",children:K?(0,S.jsx)(p.Z,{variant:"body2",sx:{marginBottom:"10px",width:"100%",textAlign:"center"},children:(0,S.jsx)("em",{style:{fontWeight:"bold",color:"#6C757D"},children:"Data are being processed, wait..."})}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.SV5,{onClick:function(){return F(null)},className:"back__icon",title:"Back to Upload New File"}),(0,S.jsx)(d.Qvc,{title:"Proceed Records Processing",className:"upload__icon",onClick:function(){return(n=n||(0,i.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!K){e.next=2;break}return e.abrupt("return");case 2:return Y(!0),J(null),n=se(A,M,k),e.next=7,oe(n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}})]})})]}):(0,S.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,S.jsxs)(p.Z,{variant:"body1",sx:{fontStyle:"italic"},children:[(0,S.jsx)(v.tJu,{style:{fontSize:"3rem",color:"#B90101"}})," The project(s) in the file does not match the project you are currently navigating. Please upload a file with the correct project."]}),(0,S.jsx)("div",{className:"upload_actions",children:(0,S.jsx)(b.SV5,{onClick:function(){return F(null)},className:"back__icon",title:"Back to Upload New File"})})]}):(0,S.jsx)(j.b,{label:"Drag and drop or browse a file to upload. File must be: ",handleChange:function(e){O(e),J(null),te(e)},name:"file",types:["csv"]})}),(0,S.jsx)(x.Z,{children:(0,S.jsx)(f.Z,{onClick:ae,disabled:K,children:"Cancel"})})]})},I=t(30168),N=(0,t(9383).Ps)(r||(r=(0,I.Z)(["\n  query GetAttendances($projectId: String!) {\n    getAttendances(project_id: $projectId) {\n      message\n      status\n      attendance {\n        attendance_id\n        participant_id\n        attendance_name\n        attendance_date\n        attendance_status\n        session_id\n        module_name\n        module_number\n        module_id\n      }\n    }\n  }\n"]))),B=t(56789),A=t(61889),F=function(e){var n,t=e.selectedProject,r=e.trainingGroups,u=e.projects,m=(0,o.useState)(!1),p=(0,s.Z)(m,2),_=p[0],f=p[1],h=(0,o.useState)(),g=(0,s.Z)(h,2),x=g[0],j=g[1],b=(0,o.useState)(!1),v=(0,s.Z)(b,2),P=v[0],C=v[1],I=(0,Z.a)(w.Q8,{variables:{projectId:t},skip:!t}),F=I.data,D=I.loading,$=I.error,O=I.refetch,G=(0,Z.a)(N,{variables:{projectId:t},skip:!t}),z=G.data,M=G.loading,U=G.error,T=(0,y.D)(w.w8),E=(0,s.Z)(T,1)[0],R=JSON.parse(window.localStorage.getItem("myPimaUserData"));(0,o.useEffect)((function(){if(F&&200===F.getParticipantsByProject.status){var e=F.getParticipantsByProject.participants.filter((function(e){return"false"===e.create_in_commcare}));j(e.length)}}),[F]);if(D||M)return(0,S.jsxs)(A.ZP,{container:!0,direction:"column",justifyContent:"center",alignItems:"center",style:{height:"100vh"},children:[(0,S.jsx)(B.Z,{color:"#0D3C61",size:15}),(0,S.jsx)("em",{style:{color:"#0D3C61"},children:"Loading Participants and Attendances..."})]});if($||U)return(0,S.jsx)(A.ZP,{container:!0,direction:"column",justifyContent:"center",alignItems:"center",style:{height:"100vh"},children:(0,S.jsxs)("em",{style:{color:"red"},children:["Error loading data: ",(null===$||void 0===$?void 0:$.message)||(null===U||void 0===U?void 0:U.message)]})});var q=F.getParticipantsByProject.participants,Q=z.getAttendances.attendance,V=[{id:"num",name:"No.",selector:function(e){return e.num},sortable:!0},{id:"full_name",name:"Full Name",selector:function(e){return e.first_name+" "+e.last_name},sortable:!0},{id:"gender",name:"Gender",selector:function(e){return"m"===e.gender?"Male":"Female"},sortable:!0},{id:"location",name:"Location",selector:function(e){return e.location},sortable:!0},{id:"tns_id",name:"TNS ID",selector:function(e){return e.tns_id},sortable:!0},{id:"training_group",name:"Training Group",selector:function(e){return e.training_group},sortable:!0},{id:"household_id",name:"HH Number",selector:function(e){return e.hh_number},sortable:!0},{id:"primary_household_member",name:"Primary HouseHold Member",selector:function(e){return(0,S.jsx)("div",{children:"1"===e.farmer_number?(0,S.jsx)(c.Z,{label:"1",color:"success",variant:"outlined"}):(0,S.jsx)(c.Z,{label:"2",color:"error",variant:"outlined"})})},sortable:!0},{id:"farmer_trainer",name:"Farmer Trainer",selector:function(e){return e.farmer_trainer},sortable:!0},{id:"business_advisor",name:"Business Advisor",selector:function(e){return e.business_advisor},sortable:!0}],H=q.map((function(e,n){var a,i={num:n+1,Project:u.find((function(e){return e.sf_project_id===t})).project_name,p_id:e.p_id,first_name:e.first_name,middle_name:e.middle_name?e.middle_name:"",last_name:e.last_name?e.last_name:"",gender:e.gender,age:e.age,coffee_tree_numbers:e.coffee_tree_numbers,phone_number:e.phone_number,farmer_sf_id:e.p_id,hh_number:e.hh_number,sf_household_id:e.household_id,ffg_id:e.ffg_id,location:e.location,tns_id:e.tns_id,training_group:r&&r.length>0&&(null===(a=r.find((function(n){return n.tg_id===e.training_group})))||void 0===a?void 0:a.tg_name)||"N/A",farmer_number:e.primary_household_member,status:e.status,farmer_trainer:e.farmer_trainer,business_advisor:e.business_advisor,create_in_commcare:e.create_in_commcare,number_of_coffee_plots:e.number_of_coffee_plots};return"a0EOj000002FMGnMAO"===t||"a0EOj000002C7ivMAC"===t?i.national_identification_id=e.coop_membership_number?e.coop_membership_number:"":i.coop_membership_number=e.coop_membership_number?e.coop_membership_number:"",i}));return(0,S.jsxs)("div",{children:[x>0&&(0,S.jsxs)("div",{className:"active-participants-dialog",children:[(0,S.jsxs)("p",{children:["You currently have ",(0,S.jsx)("strong",{children:x})," participants who have not been sent to CommCare. Please download the participant list, review the database, and ensure all information is verified before syncing with CommCare."]}),(0,S.jsx)("button",{className:"take-action-button",onClick:function(){return function(){return(n=n||(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C(!0),e.prev=1,e.next=4,E({variables:{projectId:t}});case 4:return e.next=6,O();case 6:C(!1),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0),C(!1);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}()},disabled:P,children:P?"Processing...":"Send to Commcare"})]}),(0,S.jsxs)("div",{className:"flex__heading",children:[(0,S.jsx)("h1",{className:"module__heading",children:"Registered Farmers View"})," ",("super_admin"===(null===R||void 0===R?void 0:R.role)||"ci_leadership"===(null===R||void 0===R?void 0:R.role)||"senior_business_advisor"===(null===R||void 0===R?void 0:R.role)||"project_manager"===(null===R||void 0===R?void 0:R.role)||"mel_analyst"===(null===R||void 0===R?void 0:R.role))&&(0,S.jsx)(d.Qvc,{title:"Upload New Participants",style:{fontSize:"30px",cursor:"pointer",marginLeft:"10px",fill:"#00A5A3"},onClick:function(){return f(!0)}})," "]}),q.length>0?(0,S.jsx)(l.Z,{columns:V,data:H,tableRowItem:"participants",allAttendances:Q,selectedProject:t}):(0,S.jsx)("div",{className:"no__data",children:(0,S.jsx)("h1",{style:{fontSize:"20px"},children:"No Registered Farmers Yet"})}),(0,S.jsx)(k,{open:_,setOpen:f,navigatedProject:u.find((function(e){return e.sf_project_id===t})).project_name,sfProjectId:t})]})}}}]);
//# sourceMappingURL=718.9b32200d.chunk.js.map