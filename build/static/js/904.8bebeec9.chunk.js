"use strict";(self.webpackChunkmypima_front=self.webpackChunkmypima_front||[]).push([[904],{30589:(e,t,s)=>{s.d(t,{A:()=>f});var a=s(65043),i=s(73216),n=s(58786),o=s(67805),r=s(3438),l=s(85369),d=s(68926),c=s(11238),m=s(88250);const p=()=>{const e=new Date,t=Intl.DateTimeFormat().resolvedOptions().timeZone;return`${e.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})}_at_${e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:t})}`};var u=s(45476),_=s(84548),h=s(70579);const g={rows:{style:{minHeight:"30px",cursor:"pointer"}},headCells:{style:{paddingLeft:"8px",paddingRight:"8px",backgroundColor:"#1b2a4e",color:"white"}},cells:{style:{paddingLeft:"5px",paddingRight:"5px",paddingTop:"5px",paddingBottom:"5px"}}},x=e=>{let{handleCSVExport:t,handleExcelExport:s,tableRowItem:a}=e;return(0,h.jsxs)("div",{className:"export-buttons",children:["trainsessionapprov"!==a&&(0,h.jsxs)(r.A,{variant:"outlined",sx:{color:"#1b2a4e",borderColor:"#1b2a4e"},onClick:t,children:[(0,h.jsx)(l.Mbn,{style:{marginRight:"5px"}})," CSV"]}),(0,h.jsxs)(r.A,{variant:"outlined",sx:{color:"#1b2a4e",borderColor:"#1b2a4e"},onClick:s,children:[(0,h.jsx)(l.Mbn,{style:{marginRight:"5px"}}),"trainsessionapprov"!==a?"Excel":"Download Report"]})]})},f=e=>{let{columns:t,data:s,filter:l,tableRowItem:f,allAttendances:b,selectedProject:j}=e;const v=f||window.location.pathname.split("/")[2],[y,A]=(0,a.useState)({ts_id:null}),[C,w]=(0,a.useState)(!1),[S,k]=(0,a.useState)(!1),[E,I]=(0,a.useState)(null),[R,W]=(0,a.useState)(""),[N,M]=(0,a.useState)([]),[O,D]=(0,a.useState)(!1),[L,$]=(0,a.useState)(null),F=(0,i.Zp)(),U=(0,m.I)(_.jq,{variables:{tsId:y&&y.ts_id?y.ts_id:""},skip:!y}),P="traingroup"===v?"mypima_training_group":"trainsession"===v?"mypima_training_session":"participants"===v?"Participants Data":"farmvisit"===v?"mypima_farm_visit":"mypima_attendance";(0,a.useEffect)((()=>{var e,t;U.loading||200!==(null===(e=U.data)||void 0===e||null===(t=e.trainingSessionImage)||void 0===t?void 0:t.status)||(k(!1),I(U.data.trainingSessionImage.trainingSessionImage))}),[U]);return(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"table-header-actions "+(l?"":"no-filter"),children:[l&&(0,h.jsx)(r.A,{className:"filter-button",children:"Filter"}),(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,h.jsxs)("div",{className:"search-container",children:[(0,h.jsx)("input",{type:"text",placeholder:"Search...",value:R,onChange:e=>{const a=e.target.value.toLowerCase(),i=s.filter((e=>t.some((t=>{const s=e[t.id];return null===s||void 0===s?void 0:s.toString().toLowerCase().includes(a)}))));M(i),W(e.target.value)}}),(0,h.jsx)("span",{className:"search-icon",children:(0,h.jsx)(o.LUJ,{})})]}),(0,h.jsx)(x,{handleCSVExport:()=>{if(!s||0===s.length)return void alert("No data available for export.");let e=[...t];if("farmvisit"===v){const t=[{id:"household_tns_id"},{id:"pima_farmer_id"},{id:"pima_household_id"}];e=[...e,...t]}const a=["num","Project","first_name","middle_name","last_name","gender","age","coffee_tree_numbers","number_of_coffee_plots","phone_number","a0EOj000002FMGnMAO"===j||"a0EOj000002C7ivMAC"===j?"national_identification_id":"a0EOj000003E0knMAC"===j?"growers_number":"coop_membership_number","location","farmer_sf_id","tns_id","hh_number","sf_household_id","farmer_number","ffg_id","training_group","status","farmer_trainer","a0EOj000003E0knMAC"===j?"agronomy_advisor":"business_advisor","create_in_commcare"];if("participants"===f){const e=new Map;b.filter((e=>s.some((t=>t.p_id===e.participant_id)))).forEach((t=>{const{attendance_status:s,participant_id:a,module_number:i,module_name:n,module_id:o}=t,r=`${i}-${n}-${o}`;e.has(r)||e.set(r,{});e.get(r)[a]="Present"===s?"1":"0"}));for(const[s]of e)a.push(s);const t=R.length>0?N.map((t=>{const s={...t};for(const[a,i]of e)s[a]=i[t.p_id]||"";return s})):s.map((t=>{const s={...t};for(const[a,i]of e)s[a]=i[t.p_id]||"";return s}));s=t}const i=s.map((e=>{let{tg_id:t,ts_id:s,p_id:a,attendance_id:i,fv_id:n,__typename:o,...r}=e;return r})),n=(0,d.df)({filename:P,columnHeaders:"participants"===f?a:e.map((e=>e.id))}),o=(0,d.Y_)(n)(i);o?((0,d.RG)(n)(o),console.log("Download successful"),console.log("Config:",n),console.log("Data:",s),console.log("CSV Content:",o)):console.error("Output is empty. Is your data formatted correctly?")},handleExcelExport:()=>{const e={header:t.map((e=>e.id)),body:s.map((e=>{let{tg_id:t,ts_id:s,p_id:a,attendance_id:i,fv_id:n,__typename:o,...r}=e;return Object.values(r)}))},a=s.reduce(((e,t)=>{let{farmer_trainer:s,session_image_status:a}=t;const i=`${s}_${a}`;return e[i]||(e[i]={farmer_trainer:s,session_image_status:a,count:0}),e[i].count+=1,e}),{}),i={header:["farmer_trainer","session_image_status","count"],body:Object.values(a).map((e=>Object.values(e)))},n=c.Wp.book_new(),o=c.Wp.json_to_sheet([e.header,...e.body],{skipHeader:!0}),r=c.Wp.json_to_sheet([i.header,...i.body],{skipHeader:!0});c.Wp.book_append_sheet(n,r,"Summary by Trainer"),c.Wp.book_append_sheet(n,o,"Sessions Data"),(0,c._h)(n,`${P}_${p()}.xlsx`)},tableRowItem:f})]})]}),(0,h.jsx)(n.Ay,{columns:t,data:R.length>0?N:s,onRowClicked:e=>{A(e);const t={trainsession:e.ts_id,traingroup:e.tg_id,participants:e.p_id,farmvisit:e.fv_ids,trainsessionapprov:e.ts_id}[f]||e.attendance_id;"farmvisit"!==f&&"trainsessionapprov"!==f?F(`/in/${f}/${t}`):"farmvisit"===f?($(e.fv_id),D(!0)):"trainsessionapprov"===f&&(w(!0),k(!0))},pagination:!0,highlightOnHover:!0,customStyles:g,className:"table-container"}),C&&(0,h.jsx)(u.A,{open:C,handleClose:()=>w(!1),id:y.ts_id,data:y,isVerified:y.is_verified,imageStatus:y.session_image_status,sessionImageUrl:E,selectedProject:j,loading:S})]})}},35904:(e,t,s)=>{s.r(t),s.d(t,{default:()=>_});var a=s(65043),i=s(88250),n=s(6410),o=s(62902),r=s(30589),l=s(23768),d=s(94496),c=s(3438),m=s(81637),p=s(32393),u=s(70579);const _=()=>{const[e,t]=(0,a.useState)([]),{data:s,error:_,loading:h}=(0,i.I)(o.d),[g,{loading:x}]=(0,n._)(o.$,{fetchPolicy:"no-cache",onCompleted:e=>{let{exportWetMillsDataExcel:t}=e;const{filename:s,contentBase64:a}=t;try{const e=atob(a),t=Array.from(e,(e=>e.charCodeAt(0))),i=new Blob([new Uint8Array(t)],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=URL.createObjectURL(i),o=document.createElement("a");o.href=n,o.download=s,document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(n),l.oR.success("Download started")}catch(i){console.error(i),l.oR.error("Failed to download file")}},onError:e=>{console.error(e),l.oR.error(e.message||"Export failed")}});(0,a.useEffect)((()=>{var e;200===(null===s||void 0===s||null===(e=s.getWetmills)||void 0===e?void 0:e.status)&&t(s.getWetmills.wetmills),_&&l.oR.error(_.message)}),[s,_]);const f=e.map(((e,t)=>({num:t+1,...e})));return _?(0,u.jsx)("div",{className:"circular_progress",children:(0,u.jsx)(d.A,{color:"error",children:"Error loading data"})}):(0,u.jsxs)("div",{className:"page__container",children:[(0,u.jsx)("h1",{className:"module__heading",children:"Wetmills"}),(0,u.jsx)("div",{className:"page__actions",children:(0,u.jsx)(c.A,{className:"export__button",variant:"contained",color:"primary",onClick:()=>g(),disabled:x,startIcon:x?(0,u.jsx)(m.A,{size:20}):null,children:x?"Exporting...":"Export Wet Mills Data"})}),h?(0,u.jsx)(p.A,{}):f.length>0?(0,u.jsx)(r.A,{columns:[{id:"num",name:"No.",selector:e=>e.num,sortable:!0},{id:"wet_mill_unique_id",name:"Wetmill ID",selector:e=>e.wet_mill_unique_id,sortable:!0},{id:"name",name:"Wetmill Name",selector:e=>e.name,sortable:!0},{id:"country",name:"Country",selector:e=>e.country,sortable:!0},{id:"mill_status",name:"Ownership",selector:e=>e.mill_status||"N/A",sortable:!0},{id:"exporting_status",name:"Exporting Status",selector:e=>e.exporting_status||"N/A",sortable:!0},{id:"registration_date",name:"Registered On",selector:e=>e.registration_date,sortable:!0}],data:f,tableRowItem:"wetmill"}):(0,u.jsx)("div",{className:"no__data",children:(0,u.jsx)("h1",{style:{fontSize:"20px"},children:"No Wetmills Found"})})]})}},45476:(e,t,s)=>{s.d(t,{A:()=>_});var a=s(65043),i=s(83462),n=s(17392),o=s(81637),r=s(94496),l=s(35316),d=s(68903),c=s(27149),m=s(34535),p=s(70579);const u=(0,m.Ay)("div")({position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"}),_=e=>{let{open:t,handleClose:s,sessionImageUrl:m,data:_,selectedProject:h,loading:g}=e;console.log(_);const[x,f]=(0,a.useState)(!1),[b]=(0,a.useState)(!1),j=()=>{f((e=>!e))};return(0,p.jsx)(p.Fragment,{children:g?(0,p.jsxs)(i.A,{open:t,keepMounted:!0,fullWidth:!0,"aria-describedby":"alert-dialog-slide-description",children:[(0,p.jsx)("div",{style:{margin:"20px"},children:(0,p.jsx)(n.A,{"aria-label":"close",onClick:s,sx:{position:"absolute",right:8,top:8,color:"#2b2b2b"},children:(0,p.jsx)(c.m6K,{})})}),(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[(0,p.jsx)(o.A,{}),(0,p.jsx)(r.A,{variant:"h6",style:{marginLeft:"10px"},children:"Loading Image..."})]})]}):(0,p.jsxs)(i.A,{open:t,keepMounted:!0,fullWidth:!0,"aria-describedby":"alert-dialog-slide-description",children:[b&&(0,p.jsx)(u,{children:(0,p.jsx)(o.A,{})}),(0,p.jsxs)("div",{style:{margin:"20px"},children:[(0,p.jsx)(n.A,{"aria-label":"close",onClick:s,sx:{position:"absolute",right:8,top:8,color:"#2b2b2b"},children:(0,p.jsx)(c.m6K,{})}),(0,p.jsx)(r.A,{variant:"h6",children:"Session Image"})]}),(0,p.jsx)(l.A,{children:(0,p.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,p.jsxs)(d.Ay,{item:!0,xs:12,sm:6,children:[(0,p.jsxs)(r.A,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Male Attendees:"})," ",_.total_males]}),(0,p.jsxs)(r.A,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Female Attendees:"})," ",_.total_females]}),(0,p.jsxs)(r.A,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Total Attendees:"})," ",_.total_males+_.total_females]}),(0,p.jsxs)(r.A,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Session Date:"})," ",_.session_date]}),(0,p.jsxs)(r.A,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Farmer Trainer:"})," ",_.farmer_trainer]}),(0,p.jsxs)(r.A,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Session Module:"})," ",_.ts_module]}),(0,p.jsxs)(r.A,{variant:"body1",children:[(0,p.jsx)("strong",{children:"FFG:"})," ",_.ts_group]})]}),(0,p.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,p.jsxs)("div",{style:{position:"relative"},children:[(0,p.jsx)("img",{src:m,alt:"session_pic",style:{width:"100%",height:"auto",cursor:x?"zoom-out":"zoom-in"},onClick:j}),x?(0,p.jsx)(n.A,{"aria-label":"shrink",onClick:j,sx:{position:"absolute",bottom:8,right:8,color:"#fff"},children:(0,p.jsx)(c.Llp,{})}):(0,p.jsx)(n.A,{"aria-label":"expand",onClick:j,sx:{position:"absolute",bottom:8,right:8,color:"#fff"},children:(0,p.jsx)(c.T$Z,{})})]})})]})})]})})}},62902:(e,t,s)=>{s.d(t,{$:()=>n,d:()=>i});var a=s(70459);const i=a.J1`
  query GetWetmills {
    getWetmills {
      message
      status
      wetmills {
        id
        wet_mill_unique_id
        commcare_case_id
        name
        mill_status
        exporting_status
        programe
        country
        manager_name
        manager_role
        comments
        wetmill_counter
        ba_signature
        manager_signature
        tor_page_picture
        registration_date
        created_at
        updated_at
      }
    }
  }
`,n=a.J1`
  query ExportWetmillsExcel {
    exportWetMillsDataExcel {
      filename
      contentBase64
    }
  }
`}}]);
//# sourceMappingURL=904.8bebeec9.chunk.js.map