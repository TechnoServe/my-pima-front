"use strict";(self.webpackChunkmypima_front=self.webpackChunkmypima_front||[]).push([[754],{30589:(e,t,i)=>{i.d(t,{A:()=>x});var s=i(65043),a=i(73216),n=i(58786),r=i(67805),o=i(3438),d=i(85369),l=i(68926),c=i(11238),m=i(88250);const _=()=>{const e=new Date,t=Intl.DateTimeFormat().resolvedOptions().timeZone;return`${e.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})}_at_${e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:t})}`};var p=i(45476),h=i(84548),u=i(70579);const g={rows:{style:{minHeight:"30px",cursor:"pointer"}},headCells:{style:{paddingLeft:"8px",paddingRight:"8px",backgroundColor:"#1b2a4e",color:"white"}},cells:{style:{paddingLeft:"5px",paddingRight:"5px",paddingTop:"5px",paddingBottom:"5px"}}},f=e=>{let{handleCSVExport:t,handleExcelExport:i,tableRowItem:s}=e;return(0,u.jsxs)("div",{className:"export-buttons",children:["trainsessionapprov"!==s&&(0,u.jsxs)(o.A,{variant:"outlined",sx:{color:"#1b2a4e",borderColor:"#1b2a4e"},onClick:t,children:[(0,u.jsx)(d.Mbn,{style:{marginRight:"5px"}})," CSV"]}),(0,u.jsxs)(o.A,{variant:"outlined",sx:{color:"#1b2a4e",borderColor:"#1b2a4e"},onClick:i,children:[(0,u.jsx)(d.Mbn,{style:{marginRight:"5px"}}),"trainsessionapprov"!==s?"Excel":"Download Report"]})]})},x=e=>{let{columns:t,data:i,filter:d,tableRowItem:x,allAttendances:j,selectedProject:b}=e;const v=x||window.location.pathname.split("/")[2],[y,A]=(0,s.useState)({ts_id:null}),[C,S]=(0,s.useState)(!1),[k,I]=(0,s.useState)(!1),[w,E]=(0,s.useState)(null),[F,N]=(0,s.useState)(""),[M,R]=(0,s.useState)([]),[V,$]=(0,s.useState)(!1),[O,L]=(0,s.useState)(null),T=(0,a.Zp)(),D=(0,m.I)(h.jq,{variables:{tsId:y&&y.ts_id?y.ts_id:""},skip:!y}),P="traingroup"===v?"mypima_training_group":"trainsession"===v?"mypima_training_session":"participants"===v?"Participants Data":"farmvisit"===v?"mypima_farm_visit":"mypima_attendance";(0,s.useEffect)((()=>{var e,t;D.loading||200!==(null===(e=D.data)||void 0===e||null===(t=e.trainingSessionImage)||void 0===t?void 0:t.status)||(I(!1),E(D.data.trainingSessionImage.trainingSessionImage))}),[D]);return(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{className:"table-header-actions "+(d?"":"no-filter"),children:[d&&(0,u.jsx)(o.A,{className:"filter-button",children:"Filter"}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,u.jsxs)("div",{className:"search-container",children:[(0,u.jsx)("input",{type:"text",placeholder:"Search...",value:F,onChange:e=>{const s=e.target.value.toLowerCase(),a=i.filter((e=>t.some((t=>{const i=e[t.id];return null===i||void 0===i?void 0:i.toString().toLowerCase().includes(s)}))));R(a),N(e.target.value)}}),(0,u.jsx)("span",{className:"search-icon",children:(0,u.jsx)(r.LUJ,{})})]}),(0,u.jsx)(f,{handleCSVExport:()=>{if(!i||0===i.length)return void alert("No data available for export.");let e=[...t];if("farmvisit"===v){const t=[{id:"household_tns_id"},{id:"pima_farmer_id"},{id:"pima_household_id"}];e=[...e,...t]}const s=["num","Project","first_name","middle_name","last_name","gender","age","coffee_tree_numbers","number_of_coffee_plots","phone_number","a0EOj000002FMGnMAO"===b||"a0EOj000002C7ivMAC"===b?"national_identification_id":"a0EOj000003E0knMAC"===b?"growers_number":"coop_membership_number","location","farmer_sf_id","tns_id","hh_number","sf_household_id","farmer_number","ffg_id","training_group","status","farmer_trainer","a0EOj000003E0knMAC"===b?"agronomy_advisor":"business_advisor","create_in_commcare"];if("participants"===x){const e=new Map;j.filter((e=>i.some((t=>t.p_id===e.participant_id)))).forEach((t=>{const{attendance_status:i,participant_id:s,module_number:a,module_name:n,module_id:r}=t,o=`${a}-${n}-${r}`;e.has(o)||e.set(o,{});e.get(o)[s]="Present"===i?"1":"0"}));for(const[i]of e)s.push(i);const t=F.length>0?M.map((t=>{const i={...t};for(const[s,a]of e)i[s]=a[t.p_id]||"";return i})):i.map((t=>{const i={...t};for(const[s,a]of e)i[s]=a[t.p_id]||"";return i}));i=t}const a=i.map((e=>{let{tg_id:t,ts_id:i,p_id:s,attendance_id:a,fv_id:n,__typename:r,...o}=e;return o})),n=(0,l.df)({filename:P,columnHeaders:"participants"===x?s:e.map((e=>e.id))}),r=(0,l.Y_)(n)(a);r?(0,l.RG)(n)(r):console.error("Output is empty. Is your data formatted correctly?")},handleExcelExport:()=>{const e={header:t.map((e=>e.id)),body:i.map((e=>{let{tg_id:t,ts_id:i,p_id:s,attendance_id:a,fv_id:n,__typename:r,...o}=e;return Object.values(o)}))},s=i.reduce(((e,t)=>{let{farmer_trainer:i,session_image_status:s}=t;const a=`${i}_${s}`;return e[a]||(e[a]={farmer_trainer:i,session_image_status:s,count:0}),e[a].count+=1,e}),{}),a={header:["farmer_trainer","session_image_status","count"],body:Object.values(s).map((e=>Object.values(e)))},n=c.Wp.book_new(),r=c.Wp.json_to_sheet([e.header,...e.body],{skipHeader:!0}),o=c.Wp.json_to_sheet([a.header,...a.body],{skipHeader:!0});c.Wp.book_append_sheet(n,o,"Summary by Trainer"),c.Wp.book_append_sheet(n,r,"Sessions Data"),(0,c._h)(n,`${P}_${_()}.xlsx`)},tableRowItem:x})]})]}),(0,u.jsx)(n.Ay,{columns:t,data:F.length>0?M:i,onRowClicked:e=>{A(e);const t={trainsession:e.ts_id,traingroup:e.tg_id,participants:e.p_id,farmvisit:e.fv_ids,trainsessionapprov:e.ts_id}[x]||e.attendance_id;"farmvisit"!==x&&"trainsessionapprov"!==x?T(`/in/${x}/${t}`):"farmvisit"===x?(L(e.fv_id),$(!0)):"trainsessionapprov"===x&&(S(!0),I(!0))},pagination:!0,highlightOnHover:!0,customStyles:g,className:"table-container"}),C&&(0,u.jsx)(p.A,{open:C,handleClose:()=>S(!1),id:y.ts_id,data:y,isVerified:y.is_verified,imageStatus:y.session_image_status,sessionImageUrl:w,selectedProject:b,loading:k})]})}},45476:(e,t,i)=>{i.d(t,{A:()=>h});var s=i(65043),a=i(83462),n=i(17392),r=i(81637),o=i(94496),d=i(35316),l=i(68903),c=i(27149),m=i(34535),_=i(70579);const p=(0,m.Ay)("div")({position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"}),h=e=>{let{open:t,handleClose:i,sessionImageUrl:m,data:h,selectedProject:u,loading:g}=e;console.log(h);const[f,x]=(0,s.useState)(!1),[j]=(0,s.useState)(!1),b=()=>{x((e=>!e))};return(0,_.jsx)(_.Fragment,{children:g?(0,_.jsxs)(a.A,{open:t,keepMounted:!0,fullWidth:!0,"aria-describedby":"alert-dialog-slide-description",children:[(0,_.jsx)("div",{style:{margin:"20px"},children:(0,_.jsx)(n.A,{"aria-label":"close",onClick:i,sx:{position:"absolute",right:8,top:8,color:"#2b2b2b"},children:(0,_.jsx)(c.m6K,{})})}),(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[(0,_.jsx)(r.A,{}),(0,_.jsx)(o.A,{variant:"h6",style:{marginLeft:"10px"},children:"Loading Image..."})]})]}):(0,_.jsxs)(a.A,{open:t,keepMounted:!0,fullWidth:!0,"aria-describedby":"alert-dialog-slide-description",children:[j&&(0,_.jsx)(p,{children:(0,_.jsx)(r.A,{})}),(0,_.jsxs)("div",{style:{margin:"20px"},children:[(0,_.jsx)(n.A,{"aria-label":"close",onClick:i,sx:{position:"absolute",right:8,top:8,color:"#2b2b2b"},children:(0,_.jsx)(c.m6K,{})}),(0,_.jsx)(o.A,{variant:"h6",children:"Session Image"})]}),(0,_.jsx)(d.A,{children:(0,_.jsxs)(l.Ay,{container:!0,spacing:2,children:[(0,_.jsxs)(l.Ay,{item:!0,xs:12,sm:6,children:[(0,_.jsxs)(o.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Male Attendees:"})," ",h.total_males]}),(0,_.jsxs)(o.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Female Attendees:"})," ",h.total_females]}),(0,_.jsxs)(o.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Total Attendees:"})," ",h.total_males+h.total_females]}),(0,_.jsxs)(o.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Session Date:"})," ",h.session_date]}),(0,_.jsxs)(o.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Farmer Trainer:"})," ",h.farmer_trainer]}),(0,_.jsxs)(o.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"Session Module:"})," ",h.ts_module]}),(0,_.jsxs)(o.A,{variant:"body1",children:[(0,_.jsx)("strong",{children:"FFG:"})," ",h.ts_group]})]}),(0,_.jsx)(l.Ay,{item:!0,xs:12,sm:6,children:(0,_.jsxs)("div",{style:{position:"relative"},children:[(0,_.jsx)("img",{src:m,alt:"session_pic",style:{width:"100%",height:"auto",cursor:f?"zoom-out":"zoom-in"},onClick:b}),f?(0,_.jsx)(n.A,{"aria-label":"shrink",onClick:b,sx:{position:"absolute",bottom:8,right:8,color:"#fff"},children:(0,_.jsx)(c.Llp,{})}):(0,_.jsx)(n.A,{"aria-label":"expand",onClick:b,sx:{position:"absolute",bottom:8,right:8,color:"#fff"},children:(0,_.jsx)(c.T$Z,{})})]})})]})})]})})}},54754:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_});var s=i(65043),a=i(88250),n=i(15527),r=i(30589),o=i(23768),d=i(94496),l=i(32393),c=i(73216),m=i(70579);const _=()=>{const{activeProject:e}=(0,c.KC)(),[t,i]=(0,s.useState)([]),{data:_,error:p,loading:h}=(0,a.I)(n.Vh,{variables:{projectId:e}});(0,s.useEffect)((()=>{if(_){const e=_.getFarmVisitsByProject;i(200===e.status?e.farmVisits:[])}p&&o.oR.error(p.message)}),[_,p]);const u=t?t.map(((e,t)=>({num:t+1,fv_id:e.fv_id,fv_name:e.fv_name,training_group:e.training_group,training_session:e.training_session,tg_tns_id:e.tg_tns_id,farmer_tns_id:e.farmer_tns_id,household_tns_id:e.household_tns_id,pima_household_id:e.pima_household_id,pima_farmer_id:e.pima_farmer_id,farm_visited:e.farm_visited,household_id:e.household_id,farmer_trainer:e.farmer_trainer,has_training:e.has_training,date_visited:e.date_visited,gender:e.gender}))):[];return p?(0,m.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,m.jsx)(d.A,{color:"error",children:"Error loading data"})}):(0,m.jsxs)("div",{className:"page__container",children:[(0,m.jsx)("h1",{className:"module__heading",children:"Farm Visits View"}),h?(0,m.jsx)(l.A,{}):t.length>0?(0,m.jsx)(r.A,{columns:[{id:"num",name:"No.",selector:e=>e.num,sortable:!0},{id:"training_group",name:"TG Name",selector:e=>e.training_group,sortable:!0},{id:"farmer_tns_id",name:"TNS Farmer ID",selector:e=>e.farmer_tns_id,sortable:!0},{id:"farm_visited",name:"Farm Visited",selector:e=>e.farm_visited,sortable:!0},{id:"gender",name:"Gender",selector:e=>e.gender,sortable:!0},{id:"farmer_trainer",name:"Farmer Trainer",selector:e=>e.farmer_trainer,sortable:!0},{id:"date_visited",name:"Date Visited",selector:e=>e.date_visited,sortable:!0}],data:u,tableRowItem:"farmvisit"}):(0,m.jsx)("div",{className:"no__data",children:(0,m.jsx)("h1",{style:{fontSize:"20px"},children:"No Farm Visit Yet"})})]})}}}]);
//# sourceMappingURL=754.b36ce5ea.chunk.js.map